<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>脚手架 | 前端食堂</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/assets/logo.png">
    <meta name="description" content="A lightweight creator for VuePress project.">
    <link rel="preload" href="/assets/css/0.styles.a0bdfdfc.css" as="style"><link rel="preload" href="/assets/js/app.78d16a5a.js" as="script"><link rel="preload" href="/assets/js/3.6aae29e9.js" as="script"><link rel="preload" href="/assets/js/19.c53e1e98.js" as="script"><link rel="prefetch" href="/assets/js/10.e8e4d9d0.js"><link rel="prefetch" href="/assets/js/11.f51b88d6.js"><link rel="prefetch" href="/assets/js/12.308064cc.js"><link rel="prefetch" href="/assets/js/13.4edebad8.js"><link rel="prefetch" href="/assets/js/14.005b70eb.js"><link rel="prefetch" href="/assets/js/15.0ea3516d.js"><link rel="prefetch" href="/assets/js/16.773deb60.js"><link rel="prefetch" href="/assets/js/17.2d19a447.js"><link rel="prefetch" href="/assets/js/18.70e94326.js"><link rel="prefetch" href="/assets/js/20.8f0b69c3.js"><link rel="prefetch" href="/assets/js/21.61386968.js"><link rel="prefetch" href="/assets/js/22.f7ea89c7.js"><link rel="prefetch" href="/assets/js/23.f187e0c0.js"><link rel="prefetch" href="/assets/js/24.35a2ca51.js"><link rel="prefetch" href="/assets/js/25.f8d8f872.js"><link rel="prefetch" href="/assets/js/26.b458fac9.js"><link rel="prefetch" href="/assets/js/27.46167149.js"><link rel="prefetch" href="/assets/js/28.ee2efdfc.js"><link rel="prefetch" href="/assets/js/29.957b5902.js"><link rel="prefetch" href="/assets/js/30.ad38e51e.js"><link rel="prefetch" href="/assets/js/31.76ba0b79.js"><link rel="prefetch" href="/assets/js/32.5322ea36.js"><link rel="prefetch" href="/assets/js/33.603eda6c.js"><link rel="prefetch" href="/assets/js/34.04048073.js"><link rel="prefetch" href="/assets/js/35.db42af6e.js"><link rel="prefetch" href="/assets/js/36.a3819c4c.js"><link rel="prefetch" href="/assets/js/37.8a5ed3bd.js"><link rel="prefetch" href="/assets/js/38.60d2319a.js"><link rel="prefetch" href="/assets/js/39.3fa6a500.js"><link rel="prefetch" href="/assets/js/4.8d1a23b6.js"><link rel="prefetch" href="/assets/js/40.4241fae9.js"><link rel="prefetch" href="/assets/js/41.883803af.js"><link rel="prefetch" href="/assets/js/42.907eb3d9.js"><link rel="prefetch" href="/assets/js/43.739e3ede.js"><link rel="prefetch" href="/assets/js/44.d99fecbd.js"><link rel="prefetch" href="/assets/js/45.d38bc9ce.js"><link rel="prefetch" href="/assets/js/46.9ae96c69.js"><link rel="prefetch" href="/assets/js/47.ebda2922.js"><link rel="prefetch" href="/assets/js/48.03372027.js"><link rel="prefetch" href="/assets/js/49.ae8d2601.js"><link rel="prefetch" href="/assets/js/5.00133c68.js"><link rel="prefetch" href="/assets/js/50.b396cf06.js"><link rel="prefetch" href="/assets/js/51.d4ed198c.js"><link rel="prefetch" href="/assets/js/52.e097122a.js"><link rel="prefetch" href="/assets/js/53.dab025bd.js"><link rel="prefetch" href="/assets/js/54.2f236fbf.js"><link rel="prefetch" href="/assets/js/55.ff17689c.js"><link rel="prefetch" href="/assets/js/56.9f537141.js"><link rel="prefetch" href="/assets/js/57.3e963a0f.js"><link rel="prefetch" href="/assets/js/58.abfee5f1.js"><link rel="prefetch" href="/assets/js/59.efef8fcf.js"><link rel="prefetch" href="/assets/js/6.e42c6557.js"><link rel="prefetch" href="/assets/js/60.7b5c1609.js"><link rel="prefetch" href="/assets/js/61.9d39e7b9.js"><link rel="prefetch" href="/assets/js/62.a674f1af.js"><link rel="prefetch" href="/assets/js/63.ab8188bf.js"><link rel="prefetch" href="/assets/js/64.9d0dff14.js"><link rel="prefetch" href="/assets/js/65.784a00c0.js"><link rel="prefetch" href="/assets/js/66.66b63f3c.js"><link rel="prefetch" href="/assets/js/67.f20ed9ae.js"><link rel="prefetch" href="/assets/js/68.12dc466e.js"><link rel="prefetch" href="/assets/js/69.f4c3fc57.js"><link rel="prefetch" href="/assets/js/7.7966727e.js"><link rel="prefetch" href="/assets/js/70.4fa47591.js"><link rel="prefetch" href="/assets/js/71.4875c748.js"><link rel="prefetch" href="/assets/js/72.8e2ea4c5.js"><link rel="prefetch" href="/assets/js/73.50e2a9f2.js"><link rel="prefetch" href="/assets/js/8.e71f1508.js"><link rel="prefetch" href="/assets/js/9.4fe40565.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4b66c0f2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0bdfdfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">前端食堂</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a class="ant-dropdown-link ant-dropdown-trigger">
      Hover me <i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></a> <a href="https://github.com/wjhuan/frontend-learn-route" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/web-arch/" aria-current="page" title="README.md" class="sidebar-link">README.md</a></li><li><a href="/web-arch/article-1.html" title="前端架构课需求分析" class="sidebar-link">前端架构课需求分析</a></li><li><a href="/web-arch/article-2.html" aria-current="page" title="脚手架" class="active sidebar-link">脚手架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#前端研发脚手架架构设计" title="前端研发脚手架架构设计" class="sidebar-link">前端研发脚手架架构设计</a></li><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#脚手架核心价值" title="脚手架核心价值" class="sidebar-link">脚手架核心价值</a></li><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#和自动化构建工具区别" title="和自动化构建工具区别" class="sidebar-link">和自动化构建工具区别</a></li><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#什么是脚手架" title="什么是脚手架" class="sidebar-link">什么是脚手架</a></li><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#脚手架的执行原理如下" title="脚手架的执行原理如下" class="sidebar-link">脚手架的执行原理如下</a></li><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#脚手架开发流程" title="脚手架开发流程" class="sidebar-link">脚手架开发流程</a></li><li class="sidebar-sub-header"><a href="/web-arch/article-2.html#脚手架本地-link-标准" title="脚手架本地 link 标准" class="sidebar-link">脚手架本地 link 标准</a></li></ul></li><li><a href="/web-arch/article-3.html" title="lerna" class="sidebar-link">lerna</a></li><li><a href="/web-arch/article-4.html" title="前端监控体系搭建" class="sidebar-link">前端监控体系搭建</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="脚手架"><a href="#脚手架" class="header-anchor">#</a> 脚手架</h1> <h2 id="前端研发脚手架架构设计"><a href="#前端研发脚手架架构设计" class="header-anchor">#</a> 前端研发脚手架架构设计</h2> <p><img src="/assets/img/3.f41752e5.png" alt=""></p> <h2 id="脚手架核心价值"><a href="#脚手架核心价值" class="header-anchor">#</a> 脚手架核心价值</h2> <ol><li>自动化: 项目重复代码拷贝/git 操作/发布上线操作</li> <li>标准化: 项目创建/git flow/发布流程/回滚流程</li> <li>数据化: 研发过程系统化、数据化，使得研发过程可量化</li></ol> <h2 id="和自动化构建工具区别"><a href="#和自动化构建工具区别" class="header-anchor">#</a> 和自动化构建工具区别</h2> <blockquote><p>问题: <code>jenkins、travis</code>等自动化构建工具已经比较成熟了，为什么还需要自研脚手架?</p></blockquote> <ol><li>不满足需求: <code>jenkins、travis</code>通常在<code>git hooks</code>中触发，需要在服务端执行，无法覆盖研发人员本地的功能如: 创建项目自动化、本地<code>git</code>操作自动化等</li> <li>定制复杂: <code>jenkins、travis</code>定制过程需要开发插件，其过程较为复杂，需要使用<code>java</code>语言，对前端同学不够友好</li></ol> <h2 id="什么是脚手架"><a href="#什么是脚手架" class="header-anchor">#</a> 什么是脚手架</h2> <p>脚手架本质是一个操作系统的客户端，它通过命令行执行，比如</p> <div class="language-sh extra-class"><pre class="language-sh"><code>vue create vue-test-app
</code></pre></div><p>上面这条命令由 3 个部分组成:</p> <ol><li>主命令: <code>vue</code></li> <li>command:<code>create</code></li> <li>command 的 param: <code>vue-test-app</code></li></ol> <p>它表示创建一个<code>vue</code> 项目，项目的名称为 <code>vue-test-app</code>，以上是最一个较为简单的脚手架命令，但实际场景往往更加复杂，比如:</p> <p>当前目录已经有文件了，我们需要覆盖当前目录下的文件，强制进行安装 <code>vue</code> 项目，此时我们就可以输入</p> <div class="language-sh extra-class"><pre class="language-sh"><code>vue create vue-test-app <span class="token parameter variable">--force</span>
</code></pre></div><p>这里的 <code>--force</code> 叫做 <code>option</code>可以理解为配置，还有一种场景：</p> <p>通过 <code>vue create</code> 创建项目时，会自动执行 <code>npm install</code> 帮用户安装依赖，如果我们希望使用淘宝源来安装
可以输入命令:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>vue create vue-test-app <span class="token parameter variable">--force</span> <span class="token parameter variable">-r</span> https://registry.npm.taobao.org
</code></pre></div><p>这里的 <code>-r</code> 也叫做 <code>option</code>，它与 <code>--force</code> 不同的是它使用 <code>-</code>，并且使用简写，这里的 <code>-r</code> 也可以替换成 <code>--registry</code>，有的同学可能要问，为什么老师知道这个命令，其实我们输入下面的命令就可以看到 vue create 支持的所有 options:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>vue create <span class="token parameter variable">--help</span>
</code></pre></div><p><code>-r</code> <code>https://registry.npm,taobao.org</code> 后面的 <code>https://registry.npm.taobao.org</code> 成为 <code>option</code>的
<code>param</code>，其实 <code>--force</code> 可以理解为: <code>--force true</code>，简写为: <code>--force</code> 或 <code>-f</code></p> <h2 id="脚手架的执行原理如下"><a href="#脚手架的执行原理如下" class="header-anchor">#</a> 脚手架的执行原理如下</h2> <p><img src="/assets/img/6.c3cea80c.png" alt=""></p> <ol><li>在终端输入<code>vue create vue-test-app</code></li> <li>终端解析出 <code>vue</code> 命令</li> <li>终端在环境变量中找到 <code>vue</code> 命令</li> <li>终端根据 <code>vue</code> 命令链接到实际文件 <code>vue.js</code></li> <li>终端利用 <code>node</code> 执行 <code>vue.js</code></li> <li><code>vue.js</code> 解析 <code>command / options</code></li> <li><code>vue.js</code> 执行 <code>command</code></li> <li>执行完毕，退出执行</li></ol> <h3 id="从应用的角度看如何开发一个脚手架"><a href="#从应用的角度看如何开发一个脚手架" class="header-anchor">#</a> 从应用的角度看如何开发一个脚手架</h3> <p>以<code>vue-cli</code>为例</p> <ol><li>开发 <code>npm</code> 项目，该项目中应包含一个 <code>bin/vue.js</code> 文件，并将这个项目发布到<code>npm</code></li> <li>将 <code>npm</code> 项目安装到 <code>node</code> 的 <code>lib/node_modules</code></li> <li>在 <code>node</code> 的 <code>bin</code> 目录下配置 <code>vue</code> 软链接指 <code>lib/node modules/@vue/cli/bin/vue.js</code></li></ol> <p>这样我们在执行 <code>vue</code> 命令的时候就可以找到 <code>vue.js</code> 进行执行</p> <ol><li>为什么全局安装 <code>@vue/cli</code> 后会添加的命令为 <code>vue</code>?
<blockquote><p>在<code>@vue/cli</code>项目中的<code>package.json</code>的<code>bin</code>代码下指定的名字就叫<code>vue</code></p></blockquote></li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @vue/cli
</code></pre></div><ol start="2"><li>全局安装<code>@vue/cli</code> 时发生了什么?
npm 会把@vue/cli 包下载到 node 的 lib 下的 node_modules 中，再根据<code>package.json</code>的<code>bin</code>代码配置对应的软连接</li> <li>为什么 <code>vue</code> 指向一个 <code>js</code>文件，我们却可以直接通过 <code>vue</code> 命令直接去执行它?
在 node 环境变量中找 vue 命令是否被注册，那么在 vuejs 文件中最上方要加上<code>!/usr/bin/env node</code>,意思就是可以自动使用<code>node</code>去执行这个文件</li></ol> <p><img src="/assets/img/7.6ca8a763.png" alt=""></p> <h2 id="脚手架开发流程"><a href="#脚手架开发流程" class="header-anchor">#</a> 脚手架开发流程</h2> <ol><li>创建 <code>npm</code> 项目</li> <li>创建脚手架入口文件，最上方添加</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env node</span>
</code></pre></div><ol start="3"><li>添加 <code>bin</code> 属性配置 <code>package.json</code>，</li> <li>编写脚手架代码</li> <li>将脚手架发布到 <code>npm</code></li></ol> <h3 id="难点解析"><a href="#难点解析" class="header-anchor">#</a> 难点解析</h3> <ul><li>分包: 将复杂的系统拆分成若千个模块</li> <li>命令注册</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>vue create
vue <span class="token function">add</span>
vue invoke
</code></pre></div><ul><li>参数解析</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code>vue <span class="token builtin class-name">command</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>params<span class="token operator">&gt;</span>
</code></pre></div><ul><li>options 全称:<code>--version</code>、 <code>--help</code></li> <li>options 简写: <code>-v</code>、<code>-h</code></li> <li>带 params 的 options: <code>--path /users/sam/Desktop/vue-test</code></li> <li>帮助文档</li> <li>命令行交互</li> <li>日志打印</li> <li>命令行文字变色</li> <li>网络通信: HTTP/WebSocket</li> <li>文件处理等</li></ul> <h2 id="脚手架本地-link-标准"><a href="#脚手架本地-link-标准" class="header-anchor">#</a> 脚手架本地 link 标准</h2> <ul><li>链接本地脚手架</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> <span class="token function">link</span>
</code></pre></div><ul><li>链接本地库文件</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> your-lib-dir
<span class="token function">npm</span> <span class="token function">link</span>
<span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> <span class="token function">link</span> your-lib
</code></pre></div><ul><li>取消链接本地库文件</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">cd</span> your-lib-dir
<span class="token function">npm</span> unlink
<span class="token builtin class-name">cd</span> your-cli-dir
<span class="token function">npm</span> unlink your-lib
</code></pre></div><h3 id="什么是-npm-link"><a href="#什么是-npm-link" class="header-anchor">#</a> 什么是 npm link</h3> <p><code>npm link your-lib</code>: 将当前项目中 <code>node modules</code> 下指定的库文件链接到 <code>node</code> 全局 <code>node modules</code> 下的库文件
<code>npm link</code>: 将当前项目链接到 <code>node</code> 全局<code>node modules</code> 中作为一个库文件，并解析 <code>bin</code> 配置创建可执行文件</p> <h3 id="什么是-npm-unlink"><a href="#什么是-npm-unlink" class="header-anchor">#</a> 什么是 npm unlink</h3> <p><code>npm unlink</code>:将当前项目从 <code>node</code> 全局 <code>node modules</code> 中移除
<code>npm unlink your-lib</code>: 将当前项目中的库文件依赖移除</p> <h3 id="原生脚手架开发痛点分析"><a href="#原生脚手架开发痛点分析" class="header-anchor">#</a> 原生脚手架开发痛点分析</h3> <ol><li>痛点一: 重复操作</li></ol> <ul><li>多 Package 本地 link</li> <li>多 Package 依赖安装</li> <li>多 Package 单元测试</li> <li>多 Package 代码提交</li> <li>多 Package 代码发布</li></ul> <ol start="2"><li>痛点二: 版本一致性</li></ol> <ul><li>发布时版本一致性</li> <li>发布后相互依赖版本升级</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/14/2023, 5:42:44 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/web-arch/article-1.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        前端架构课需求分析
      </a></span> <span class="next"><a href="/web-arch/article-3.html">
        lerna
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.78d16a5a.js" defer></script><script src="/assets/js/3.6aae29e9.js" defer></script><script src="/assets/js/19.c53e1e98.js" defer></script>
  </body>
</html>