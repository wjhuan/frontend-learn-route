<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Node | 前端食堂</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/assets/logo.png">
    <meta name="description" content="A lightweight creator for VuePress project.">
    <link rel="preload" href="/assets/css/0.styles.a0bdfdfc.css" as="style"><link rel="preload" href="/assets/js/app.35af8aa6.js" as="script"><link rel="preload" href="/assets/js/3.dc37dcdc.js" as="script"><link rel="preload" href="/assets/js/21.0c2cb078.js" as="script"><link rel="prefetch" href="/assets/js/10.612e230f.js"><link rel="prefetch" href="/assets/js/11.c101dc61.js"><link rel="prefetch" href="/assets/js/12.aaf27af1.js"><link rel="prefetch" href="/assets/js/13.24769d74.js"><link rel="prefetch" href="/assets/js/14.310913e8.js"><link rel="prefetch" href="/assets/js/15.ec24d364.js"><link rel="prefetch" href="/assets/js/16.d6d82031.js"><link rel="prefetch" href="/assets/js/17.d2a81a23.js"><link rel="prefetch" href="/assets/js/18.2b797387.js"><link rel="prefetch" href="/assets/js/19.8d75321d.js"><link rel="prefetch" href="/assets/js/20.83a9917d.js"><link rel="prefetch" href="/assets/js/22.5a162c1b.js"><link rel="prefetch" href="/assets/js/23.f013f4a1.js"><link rel="prefetch" href="/assets/js/24.18e3ea48.js"><link rel="prefetch" href="/assets/js/25.81286a3a.js"><link rel="prefetch" href="/assets/js/26.357d2d2f.js"><link rel="prefetch" href="/assets/js/27.49919d46.js"><link rel="prefetch" href="/assets/js/28.0ec81da1.js"><link rel="prefetch" href="/assets/js/29.ba8366b6.js"><link rel="prefetch" href="/assets/js/30.838d7d5b.js"><link rel="prefetch" href="/assets/js/31.1f3978fe.js"><link rel="prefetch" href="/assets/js/32.0d77346e.js"><link rel="prefetch" href="/assets/js/33.69399d1b.js"><link rel="prefetch" href="/assets/js/34.10e92eec.js"><link rel="prefetch" href="/assets/js/35.da0e2d38.js"><link rel="prefetch" href="/assets/js/36.458f916d.js"><link rel="prefetch" href="/assets/js/37.82be7a94.js"><link rel="prefetch" href="/assets/js/38.536d8a73.js"><link rel="prefetch" href="/assets/js/39.6d019b73.js"><link rel="prefetch" href="/assets/js/4.52b1f8fa.js"><link rel="prefetch" href="/assets/js/40.f04d3760.js"><link rel="prefetch" href="/assets/js/41.8775852e.js"><link rel="prefetch" href="/assets/js/42.b812073d.js"><link rel="prefetch" href="/assets/js/43.549978ae.js"><link rel="prefetch" href="/assets/js/44.275c6310.js"><link rel="prefetch" href="/assets/js/45.49e7e194.js"><link rel="prefetch" href="/assets/js/46.29808115.js"><link rel="prefetch" href="/assets/js/47.10da2067.js"><link rel="prefetch" href="/assets/js/48.1e323c0c.js"><link rel="prefetch" href="/assets/js/49.257eb328.js"><link rel="prefetch" href="/assets/js/5.9fb1676b.js"><link rel="prefetch" href="/assets/js/50.8fecaeb9.js"><link rel="prefetch" href="/assets/js/51.12524026.js"><link rel="prefetch" href="/assets/js/52.1934343b.js"><link rel="prefetch" href="/assets/js/53.af9b8d9c.js"><link rel="prefetch" href="/assets/js/54.ef375a01.js"><link rel="prefetch" href="/assets/js/55.b68b9cd4.js"><link rel="prefetch" href="/assets/js/56.c7a8ace3.js"><link rel="prefetch" href="/assets/js/57.c21beeac.js"><link rel="prefetch" href="/assets/js/58.d3b315da.js"><link rel="prefetch" href="/assets/js/59.753d7ba7.js"><link rel="prefetch" href="/assets/js/6.2a7cfe6c.js"><link rel="prefetch" href="/assets/js/60.29ca43c1.js"><link rel="prefetch" href="/assets/js/61.c0eead57.js"><link rel="prefetch" href="/assets/js/62.d48b7849.js"><link rel="prefetch" href="/assets/js/63.77aff366.js"><link rel="prefetch" href="/assets/js/64.5718074c.js"><link rel="prefetch" href="/assets/js/65.007ebc5d.js"><link rel="prefetch" href="/assets/js/66.1b81f6aa.js"><link rel="prefetch" href="/assets/js/67.19275aba.js"><link rel="prefetch" href="/assets/js/68.28e6d2ec.js"><link rel="prefetch" href="/assets/js/7.20c81c08.js"><link rel="prefetch" href="/assets/js/8.a60053fd.js"><link rel="prefetch" href="/assets/js/9.06b52a05.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.25429ca7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0bdfdfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">前端食堂</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a class="ant-dropdown-link ant-dropdown-trigger">
      Hover me <i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></a> <a href="https://github.com/wjhuan/frontend-learn-route" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/node/" aria-current="page" title="README.md" class="sidebar-link">README.md</a></li><li><a href="/node/article-1.html" title="高阶函数" class="sidebar-link">高阶函数</a></li><li><a href="/node/article-2.html" title="初识Promise" class="sidebar-link">初识Promise</a></li><li><a href="/node/article-3.html" title="异步编程" class="sidebar-link">异步编程</a></li><li><a href="/node/article-5.html" title="Event Loop" class="sidebar-link">Event Loop</a></li><li><a href="/node/article-6.html" aria-current="page" title="Node" class="active sidebar-link">Node</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node/article-6.html#node-基本概念" title="Node 基本概念" class="sidebar-link">Node 基本概念</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#node-解决了哪些问题" title="Node 解决了哪些问题" class="sidebar-link">Node 解决了哪些问题</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#js-单线程" title="JS 单线程" class="sidebar-link">JS 单线程</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#同步异步和阻塞非阻塞" title="同步异步和阻塞非阻塞" class="sidebar-link">同步异步和阻塞非阻塞</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#node-中全局对象" title="Node 中全局对象" class="sidebar-link">Node 中全局对象</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#node-中的模块" title="Node 中的模块" class="sidebar-link">Node 中的模块</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#commonjs-规范" title="commonjs 规范" class="sidebar-link">commonjs 规范</a></li><li class="sidebar-sub-header"><a href="/node/article-6.html#events-模块" title="Events 模块" class="sidebar-link">Events 模块</a></li></ul></li><li><a href="/node/article-7.html" title="npm" class="sidebar-link">npm</a></li><li><a href="/node/article-8.html" title="buffer" class="sidebar-link">buffer</a></li><li><a href="/node/article-9.html" title="HTTP核心概念" class="sidebar-link">HTTP核心概念</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="node"><a href="#node" class="header-anchor">#</a> Node</h1> <h2 id="node-基本概念"><a href="#node-基本概念" class="header-anchor">#</a> Node 基本概念</h2> <p><code>Node.js</code>是一个基于<code>Chrome V8</code>引擎的<code>JavaScript</code>运行环境<code>(runtime)</code>，<code>Node</code>不是一门语言是让<code>js</code>运行在后端的运行时,并且不包括<code>javascript</code>全集，因为在服务端中不包含<code>DOM</code>和<code>BOM</code>，<code>Node</code>也提供了一些新的模块例如<code>http</code>、<code>fs</code>模块等。<code>Node.js</code>使用了事件驱动、非阻塞式<code>I/O</code>的模型，使其轻量又高效并且<code>Node.js</code>的包管理器 <code>npm</code>，是全球最大的开源库生态系统。</p> <ul><li><code>node</code>中没有锁的概念</li> <li><code>node</code>的应用场景 处理 <code>I/O</code> (文件读写)密集型，不适合处理<code>cpu</code>密集型 (压缩加密 和计算相关的)</li> <li><code>node</code>中处理多个异步操作同一个文件件的场景 <code>（靠队列实现）</code></li></ul> <h2 id="node-解决了哪些问题"><a href="#node-解决了哪些问题" class="header-anchor">#</a> Node 解决了哪些问题</h2> <p><code>Node</code>在处理高并发，<code>I/O</code>密集场景有明显的性能优势</p> <ul><li>高并发，是指在同一时间并发访问服务器</li> <li><code>I/O</code>密集指的是文件操作、网络操作、数据库，相对的有<code>CPU</code>密集，<code>CPU</code>密集指的是逻辑处理运算、压缩、解压、加密、解密</li> <li>可以解析<code>js</code>语法用于服务端渲染 vue，react</li> <li>可以做中间层 （跨域）</li> <li>前端会用<code>node</code>来实现很多工具</li> <li>也可以做后端 <code>mongo mysql</code></li></ul> <h2 id="js-单线程"><a href="#js-单线程" class="header-anchor">#</a> JS 单线程</h2> <p><code>javascript</code>在最初设计时设计成了单线程，为什么不是多线程呢？如果多个线程同时操作<code>DOM</code>那岂不会很混乱？这里所谓的单线程指的是主线程是单线程的，所以在<code>Node</code>中主线程依旧是单线程的。</p> <ul><li>单线程特点是节约了内存，并且不需要在切换执行上下文</li> <li>而且单线程不需要管锁的问题</li></ul> <h2 id="同步异步和阻塞非阻塞"><a href="#同步异步和阻塞非阻塞" class="header-anchor">#</a> 同步异步和阻塞非阻塞</h2> <ul><li>同步就是在执行某段代码时，代码没有得到返回之前，其他代码无法执行，当得到了返回值后可以继续执行其他代码</li> <li>异步就是在执行某段代码时，代码不会立即得到返回结果，可以继续执行其他代码，返回值通过回调来获取</li></ul> <p><img src="/assets/img/async.1a033437.png" alt=""></p> <h2 id="node-中全局对象"><a href="#node-中全局对象" class="header-anchor">#</a> Node 中全局对象</h2> <p>服务端全局变量原则是是<code>global</code>，但是<code>node</code>在执行的时候为了实现模块化，会在执行代码时，外部包装一个函数，这个函数在执行的时候，会改变<code>this</code>指向</p> <ul><li><code>Buffer</code></li> <li><code>process</code> <ul><li><code>process.platform</code> 识别系统</li> <li><code>process.cwd()</code> 获取执行命令时的路径，<code>webpack</code>(查找配置文件，在当前执行命令的路径下查找)</li> <li><code>process.env.NODE_ENV</code> 在执行命令的时候（添加的变量），可以去读取环境变量中的属性，<code>windows</code>下 可以使用<code>set</code>命令来设置，<code>mac</code>下使用<code>export</code>命令来设置，<code>cross-env</code>可以实现系统兼容，环境变量都是临时的，窗口关掉就消失了</li> <li><code>process.argv</code> 执行命令时所带的参数 1.代表的是可执行<code>node.exe</code> 2.执行的是哪个文件</li></ul></li> <li><code>setInterval,setTimeout,setImmediate</code></li> <li><code>console</code></li> <li><code>queueMicrotask</code></li></ul> <h2 id="node-中的模块"><a href="#node-中的模块" class="header-anchor">#</a> Node 中的模块</h2> <p>下面五个可以直接用，但是不能用<code>global</code>来调用，因为他们是函数的参数</p> <ul><li><code>__dirname</code> 文件所在的目录 是一个绝对路径</li> <li><code>__filename</code> 代表文件的所在位置 是一个绝对路径</li> <li><code>exports</code></li> <li><code>module</code></li> <li><code>require()</code></li></ul> <h2 id="commonjs-规范"><a href="#commonjs-规范" class="header-anchor">#</a> commonjs 规范</h2> <ol><li>每个 js 文件都是一个模块</li> <li>模块的导出 module.exports</li> <li>模块的导入 require</li></ol> <h3 id="node-中的模块的分类"><a href="#node-中的模块的分类" class="header-anchor">#</a> node 中的模块的分类</h3> <ol><li>核心模块/内置模块 fs http path 不需要安装 引入的时候不需要增加相对路径、绝对路径</li> <li>第三方模块需要安装</li> <li>自定义模块需要通过绝对路径或者相对路径进行引入</li></ol> <h3 id="模块华实现"><a href="#模块华实现" class="header-anchor">#</a> 模块华实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vm'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">Module</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id
  <span class="token keyword">this</span><span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
Module<span class="token punctuation">.</span>wrapper <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(function(exports,require,module,__filename,__dirname){</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">})</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
Module<span class="token punctuation">.</span>_extensions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'.js'</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> content <span class="token operator">+</span> Module<span class="token punctuation">.</span>wrapper<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> vm<span class="token punctuation">.</span><span class="token function">runInThisContext</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token keyword">let</span> exports <span class="token operator">=</span> module<span class="token punctuation">.</span>exports
    <span class="token keyword">let</span> dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> req<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> dirname<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'.json'</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
Module<span class="token punctuation">.</span><span class="token function-variable function">_resolveFilename</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> absPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>
  <span class="token keyword">let</span> isExists <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>absPath<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isExists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> absPath
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> newPath <span class="token operator">=</span> absPath <span class="token operator">+</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">let</span> flag <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>newPath<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> newPath
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'module not exists'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">Module</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">load</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> extName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  Module<span class="token punctuation">.</span>_extensions<span class="token punctuation">[</span>extName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
Module<span class="token punctuation">.</span>_cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token parameter">filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  filename <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">_resolveFilename</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
  <span class="token keyword">let</span> cacheModule <span class="token operator">=</span> Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>filename<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cacheModule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cacheModule<span class="token punctuation">.</span>exports
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Module</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
  Module<span class="token punctuation">.</span>_cache<span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> module
  module<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports
<span class="token punctuation">}</span>
</code></pre></div><h2 id="events-模块"><a href="#events-模块" class="header-anchor">#</a> Events 模块</h2> <p>node 中自己实现的发布订阅模块,订阅是将方法对应成一种一对多的关系，on 方法用来订阅事件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">on</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

  <span class="token comment">// 如果用户绑定的不是newListener 让newListener的回调函数执行</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>eventName <span class="token operator">!==</span> <span class="token string">'newListener'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span><span class="token string">'newListener'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span><span class="token string">'newListener'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span>eventName<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">]</span> <span class="token comment">// {newListener:[fn1]}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>off 方法可以移除对应的事件监听</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 移除绑定的事件</span>
<span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">off</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> fn <span class="token operator">!=</span> callback <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span>l <span class="token operator">!==</span> callback
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>emit 用来执行订阅的事件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>once 绑定事件当执行后自动删除订阅的事件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">EventEmitter</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token function-variable function">one</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token comment">// 删除掉这个函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> one<span class="token punctuation">)</span> <span class="token comment">// 执行完后在删除掉</span>
  <span class="token punctuation">}</span>
  one<span class="token punctuation">.</span>l <span class="token operator">=</span> callback <span class="token comment">// one.l = fn;</span>
  <span class="token comment">// 先绑定一个once函数，等待emit触发完后执行one函数 ，执行原有的逻辑，执行后删除once函数</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span> one<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/20/2023, 5:50:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/node/article-5.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        Event Loop
      </a></span> <span class="next"><a href="/node/article-7.html">
        npm
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.35af8aa6.js" defer></script><script src="/assets/js/3.dc37dcdc.js" defer></script><script src="/assets/js/21.0c2cb078.js" defer></script>
  </body>
</html>