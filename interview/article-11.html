<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>微信小程序面试题 | 前端食堂</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/assets/logo.png">
    <meta name="description" content="A lightweight creator for VuePress project.">
    <link rel="preload" href="/assets/css/0.styles.a0bdfdfc.css" as="style"><link rel="preload" href="/assets/js/app.db4255f7.js" as="script"><link rel="preload" href="/assets/js/3.a5cb75aa.js" as="script"><link rel="preload" href="/assets/js/11.4457209d.js" as="script"><link rel="prefetch" href="/assets/js/10.4de6e24c.js"><link rel="prefetch" href="/assets/js/12.2a6bcbb3.js"><link rel="prefetch" href="/assets/js/13.a3e06e34.js"><link rel="prefetch" href="/assets/js/14.a16ab88e.js"><link rel="prefetch" href="/assets/js/15.80863f6b.js"><link rel="prefetch" href="/assets/js/16.97ed1c70.js"><link rel="prefetch" href="/assets/js/17.efc7c584.js"><link rel="prefetch" href="/assets/js/18.f8d9e7ec.js"><link rel="prefetch" href="/assets/js/19.f4c3113b.js"><link rel="prefetch" href="/assets/js/20.0554da4e.js"><link rel="prefetch" href="/assets/js/21.69860b07.js"><link rel="prefetch" href="/assets/js/22.4e90e2ef.js"><link rel="prefetch" href="/assets/js/23.9e20e883.js"><link rel="prefetch" href="/assets/js/24.954829dd.js"><link rel="prefetch" href="/assets/js/25.3334b814.js"><link rel="prefetch" href="/assets/js/26.36d601b5.js"><link rel="prefetch" href="/assets/js/27.8c2f8ae3.js"><link rel="prefetch" href="/assets/js/28.aa20fe99.js"><link rel="prefetch" href="/assets/js/29.502a8969.js"><link rel="prefetch" href="/assets/js/30.75eeb0b5.js"><link rel="prefetch" href="/assets/js/31.4658923b.js"><link rel="prefetch" href="/assets/js/32.3b279873.js"><link rel="prefetch" href="/assets/js/33.cf2b5de9.js"><link rel="prefetch" href="/assets/js/34.8503f271.js"><link rel="prefetch" href="/assets/js/35.3c8e7d29.js"><link rel="prefetch" href="/assets/js/36.437d0f2d.js"><link rel="prefetch" href="/assets/js/37.005c9168.js"><link rel="prefetch" href="/assets/js/38.2ecae659.js"><link rel="prefetch" href="/assets/js/39.58adc638.js"><link rel="prefetch" href="/assets/js/4.ebd5c7e1.js"><link rel="prefetch" href="/assets/js/40.8863d947.js"><link rel="prefetch" href="/assets/js/41.5fc019a5.js"><link rel="prefetch" href="/assets/js/42.307e3665.js"><link rel="prefetch" href="/assets/js/43.1f937ece.js"><link rel="prefetch" href="/assets/js/44.1288955d.js"><link rel="prefetch" href="/assets/js/45.c3ad2dcf.js"><link rel="prefetch" href="/assets/js/46.01227659.js"><link rel="prefetch" href="/assets/js/47.21dc3e59.js"><link rel="prefetch" href="/assets/js/48.079689fd.js"><link rel="prefetch" href="/assets/js/49.64f8deef.js"><link rel="prefetch" href="/assets/js/5.3ec5209b.js"><link rel="prefetch" href="/assets/js/50.a39024df.js"><link rel="prefetch" href="/assets/js/51.7d4cf1da.js"><link rel="prefetch" href="/assets/js/52.e92eaca1.js"><link rel="prefetch" href="/assets/js/53.6e121152.js"><link rel="prefetch" href="/assets/js/54.57b76576.js"><link rel="prefetch" href="/assets/js/55.14c96737.js"><link rel="prefetch" href="/assets/js/56.87e660f9.js"><link rel="prefetch" href="/assets/js/57.985a2f00.js"><link rel="prefetch" href="/assets/js/58.86671b6d.js"><link rel="prefetch" href="/assets/js/59.27d2b623.js"><link rel="prefetch" href="/assets/js/6.18f1be11.js"><link rel="prefetch" href="/assets/js/60.4195c793.js"><link rel="prefetch" href="/assets/js/61.5a581a2d.js"><link rel="prefetch" href="/assets/js/62.933f81dd.js"><link rel="prefetch" href="/assets/js/63.fe58d2ce.js"><link rel="prefetch" href="/assets/js/64.19c07325.js"><link rel="prefetch" href="/assets/js/65.f9f0eec6.js"><link rel="prefetch" href="/assets/js/66.b9ae967b.js"><link rel="prefetch" href="/assets/js/67.f5610f48.js"><link rel="prefetch" href="/assets/js/68.d9f1c646.js"><link rel="prefetch" href="/assets/js/69.22a44fd9.js"><link rel="prefetch" href="/assets/js/7.0927ac8c.js"><link rel="prefetch" href="/assets/js/70.bc88a09e.js"><link rel="prefetch" href="/assets/js/71.064eea43.js"><link rel="prefetch" href="/assets/js/72.8cdb5991.js"><link rel="prefetch" href="/assets/js/73.8d9003b8.js"><link rel="prefetch" href="/assets/js/74.08e19a9b.js"><link rel="prefetch" href="/assets/js/75.d61f7a90.js"><link rel="prefetch" href="/assets/js/76.a1caa3f8.js"><link rel="prefetch" href="/assets/js/77.1cccf5e0.js"><link rel="prefetch" href="/assets/js/8.10ced548.js"><link rel="prefetch" href="/assets/js/9.afe51493.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0d6d3bd4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0bdfdfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">前端食堂</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a class="ant-dropdown-link ant-dropdown-trigger">
      Hover me <i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></a> <a href="https://github.com/wjhuan/frontend-learn-route" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/interview/" aria-current="page" title="README.md" class="sidebar-link">README.md</a></li><li><a href="/interview/article-1.html" title="CSS面试题" class="sidebar-link">CSS面试题</a></li><li><a href="/interview/article-2.html" title="DOM和BOM面试题" class="sidebar-link">DOM和BOM面试题</a></li><li><a href="/interview/article-3.html" title="webpack和babel面试题" class="sidebar-link">webpack和babel面试题</a></li><li><a href="/interview/article-4.html" title="js面试题" class="sidebar-link">js面试题</a></li><li><a href="/interview/article-5.html" title="网络面试题" class="sidebar-link">网络面试题</a></li><li><a href="/interview/article-6.html" title="VUE2 VUE3面试题" class="sidebar-link">VUE2 VUE3面试题</a></li><li><a href="/interview/article-7.html" title="nodejs 面试题" class="sidebar-link">nodejs 面试题</a></li><li><a href="/interview/article-8.html" title="实战经验" class="sidebar-link">实战经验</a></li><li><a href="/interview/article-9.html" title="typescript面试题" class="sidebar-link">typescript面试题</a></li><li><a href="/interview/article-10.html" title="算法面试题" class="sidebar-link">算法面试题</a></li><li><a href="/interview/article-11.html" aria-current="page" title="微信小程序面试题" class="active sidebar-link">微信小程序面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/article-11.html#说说你对微信小程序的理解-优缺点" title="说说你对微信小程序的理解？优缺点？" class="sidebar-link">说说你对微信小程序的理解？优缺点？</a></li><li class="sidebar-sub-header"><a href="/interview/article-11.html#微信小程序的生命周期函数有哪些" title="微信小程序的生命周期函数有哪些？" class="sidebar-link">微信小程序的生命周期函数有哪些？</a></li><li class="sidebar-sub-header"><a href="/interview/article-11.html#微信小程序的登录流程" title="微信小程序的登录流程？" class="sidebar-link">微信小程序的登录流程？</a></li><li class="sidebar-sub-header"><a href="/interview/article-11.html#微信小程序中路由跳转的方式有哪些-区别" title="微信小程序中路由跳转的方式有哪些？区别？" class="sidebar-link">微信小程序中路由跳转的方式有哪些？区别？</a></li><li class="sidebar-sub-header"><a href="/interview/article-11.html#提高微信小程序的应用速度的手段有哪些" title="提高微信小程序的应用速度的手段有哪些？" class="sidebar-link">提高微信小程序的应用速度的手段有哪些？</a></li><li class="sidebar-sub-header"><a href="/interview/article-11.html#说说微信小程序的支付流程" title="说说微信小程序的支付流程？" class="sidebar-link">说说微信小程序的支付流程？</a></li><li class="sidebar-sub-header"><a href="/interview/article-11.html#谈谈微信小程序的实现原理" title="谈谈微信小程序的实现原理？" class="sidebar-link">谈谈微信小程序的实现原理？</a></li></ul></li><li><a href="/interview/article-12.html" title="3D图形学面试题" class="sidebar-link">3D图形学面试题</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="微信小程序面试题"><a href="#微信小程序面试题" class="header-anchor">#</a> 微信小程序面试题</h1> <h2 id="说说你对微信小程序的理解-优缺点"><a href="#说说你对微信小程序的理解-优缺点" class="header-anchor">#</a> 说说你对微信小程序的理解？优缺点？</h2> <h3 id="什么是微信小程序"><a href="#什么是微信小程序" class="header-anchor">#</a> 什么是微信小程序</h3> <blockquote><p>微信小程序是一种不需要下载安装即可使用的应用,它实现了应用“触手可及”的梦想,用户扫一扫或者搜一下即可打开应用。</p></blockquote> <blockquote><p>小程序也体现了“用完即走”的理念,用户不用关心是否安装太多应用的问题。应用将无处不在,随时可用,但又无需安装卸载。</p></blockquote> <h3 id="小程序的由来"><a href="#小程序的由来" class="header-anchor">#</a> 小程序的由来</h3> <p>当微信中的 WebView 逐渐成为移动 Web 的一个重要入口时,微信就有相关的 JS-SDK。JS-SDK 解决了移动网页能力不足的问题,但没有解决体验不良的问题。</p> <p>为此,小程序应运而生,具有:</p> <ul><li>快速加载</li> <li>更强大的能力</li> <li>原生体验</li> <li>易用的微信数据开放</li> <li>高效简单的开发</li></ul> <p>小程序页面本质上是网页,技术模型与 H5 类似,只是自定义了 WXML 标签。</p> <h3 id="小程序的优缺点"><a href="#小程序的优缺点" class="header-anchor">#</a> 小程序的优缺点</h3> <p>优点:</p> <ul><li>随用随走,代替许多 APP</li> <li>借助平台流量,易被接受</li> <li>相对安全</li> <li>开发门槛低</li> <li>降低兼容性限制</li></ul> <p>缺点:</p> <ul><li>用户留存率不高</li> <li>体积限制,无法开发大型小程序</li> <li>受限于微信管控,自由度较低</li></ul> <blockquote><p>微信小程序结合了 APP 和网页的优点,为用户和开发者带来便利,但也存在自身的限制。以其便捷性为先,逐步优化体验,或可成为移动端一个重要的形式。</p></blockquote> <h2 id="微信小程序的生命周期函数有哪些"><a href="#微信小程序的生命周期函数有哪些" class="header-anchor">#</a> 微信小程序的生命周期函数有哪些？</h2> <h3 id="一、应用生命周期"><a href="#一、应用生命周期" class="header-anchor">#</a> 一、应用生命周期</h3> <p>应用生命周期函数定义在 app.js 中。</p> <ul><li>onLaunch 小程序初始化完成时触发(全局只触发一次)</li> <li>onShow 小程序启动,或从后台进入前台显示时触发</li> <li>onHide 小程序从前台进入后台时触发</li> <li>onError 小程序发生脚本错误或 API 调用报错时触发</li> <li>onPageNotFound 小程序要打开的页面不存在时触发</li> <li>onUnhandledRejection 小程序有未处理的 Promise 拒绝时触发</li> <li>onThemeChange 系统切换主题时触发</li></ul> <h3 id="二、页面生命周期"><a href="#二、页面生命周期" class="header-anchor">#</a> 二、页面生命周期</h3> <p>页面生命周期函数在 page.js 中定义。</p> <ul><li>onLoad 页面加载时触发 用于加载页面数据</li> <li>onShow 页面显示时触发 页面重新显示时刷新数据</li> <li>onReady 页面初次渲染完成时触发 获取页面 DOM 节点</li> <li>onHide 页面隐藏时触发 停止页面动画或计时器等</li> <li>onUnload 页面卸载时触发 停止网络请求或清理订阅等</li></ul> <h3 id="三、组件生命周期"><a href="#三、组件生命周期" class="header-anchor">#</a> 三、组件生命周期</h3> <p>组件生命周期函数在 component.js 中定义。</p> <ul><li>created 组件实例刚创建时触发</li> <li>attached 组件进入页面节点树时触发</li> <li>ready 组件首次渲染完成时触发</li> <li>moved 组件位置改变时触发</li> <li>detached 组件离开页面节点树时触发</li> <li>error 组件方法错误时触发</li></ul> <h3 id="四、执行顺序"><a href="#四、执行顺序" class="header-anchor">#</a> 四、执行顺序</h3> <p>一个典型的完整生命周期顺序为:</p> <ol><li><p>小程序打开:onLaunch -&gt; onShow -&gt; onLoad -&gt; onShow -&gt; onReady</p></li> <li><p>进入新页面:onHide -&gt; onLoad -&gt; onShow -&gt; onReady</p></li> <li><p>返回上一页:onUnload -&gt; onShow</p></li> <li><p>小程序切后台:onHide</p></li> <li><p>小程序重启:onLaunch -&gt; onShow</p></li></ol> <h2 id="微信小程序的登录流程"><a href="#微信小程序的登录流程" class="header-anchor">#</a> 微信小程序的登录流程？</h2> <p>微信小程序的登录流程主要可以概括为以下步骤:</p> <h3 id="一、获取-code"><a href="#一、获取-code" class="header-anchor">#</a> 一、获取 code</h3> <ol><li><p>用户在小程序内点击登录按钮</p></li> <li><p>调用 wx.login()获取 code</p></li></ol> <h3 id="二、获取-openid"><a href="#二、获取-openid" class="header-anchor">#</a> 二、获取 openid</h3> <ol><li><p>将 code 发送到开发者服务器</p></li> <li><p>开发者服务器使用 code 向微信服务器获取 openid 和 session_key</p></li></ol> <h3 id="三、校验-openid"><a href="#三、校验-openid" class="header-anchor">#</a> 三、校验 openid</h3> <ol><li><p>开发者服务器拿到 openid,去数据库查询是否已存在</p></li> <li><p>若不存在,表示新用户,创建新记录</p></li> <li><p>若存在,校验用户信息,生成自定义登录态</p></li></ol> <h3 id="四、返回登录态"><a href="#四、返回登录态" class="header-anchor">#</a> 四、返回登录态</h3> <ol><li><p>开发者服务器将登录态返回给小程序</p></li> <li><p>小程序存储登录态到本地</p></li></ol> <h3 id="五、校验登录态"><a href="#五、校验登录态" class="header-anchor">#</a> 五、校验登录态</h3> <ol><li><p>小程序重新启动时可校验登录态</p></li> <li><p>调用 wx.checkSessionAPI 验证登录态是否过期</p></li> <li><p>过期则重新执行登录流程,未过期则继续使用</p></li></ol> <p><img src="/assets/img/257036641-1808ddca-dea9-4880-a9b9-49cd97bab5fa.cdeb367e.png" alt=""></p> <h2 id="微信小程序中路由跳转的方式有哪些-区别"><a href="#微信小程序中路由跳转的方式有哪些-区别" class="header-anchor">#</a> 微信小程序中路由跳转的方式有哪些？区别？</h2> <h3 id="一、wx-navigateto"><a href="#一、wx-navigateto" class="header-anchor">#</a> 一、wx.navigateTo</h3> <p>保留当前页面,跳转到应用内的某个页面。可以使用 wx.navigateBack 回到原页面。</p> <p>特点:页面栈增多,占用内存。
参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'test?id=1'</span> <span class="token comment">// 需要跳转的应用内非 tabBar 的页面的路径</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="二、wx-redirectto"><a href="#二、wx-redirectto" class="header-anchor">#</a> 二、wx.redirectTo</h3> <p>关闭当前页面,跳转到应用内的某个页面。</p> <p>特点:不能回到原页面,页面栈不增加。</p> <p>参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'test?id=1'</span> <span class="token comment">// 需要跳转的应用内非 tabBar 的页面的路径</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="三、wx-switchtab"><a href="#三、wx-switchtab" class="header-anchor">#</a> 三、wx.switchTab</h3> <p>跳转到 tabBar 页面,关闭其他所有非 tabBar 页面。</p> <p>特点:页面栈清空只留下新的 tabBar 页面。</p> <p>参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'test'</span> <span class="token comment">// 需要跳转的 tabBar 页面的路径</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="四、wx-navigateback"><a href="#四、wx-navigateback" class="header-anchor">#</a> 四、wx.navigateBack</h3> <p>关闭当前页面,返回上一页面或多级页面。</p> <p>特点:页面栈逐级退出,减少内存占用。</p> <p>参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">delta</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token comment">// 返回的页面数</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="五、wx-relaunch"><a href="#五、wx-relaunch" class="header-anchor">#</a> 五、wx.reLaunch</h3> <p>关闭所有页面,打开到应用内的某个页面。</p> <p>特点:页面栈清空只留下新的页面。</p> <p>参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'test'</span> <span class="token comment">// 需要跳转的页面路径</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="提高微信小程序的应用速度的手段有哪些"><a href="#提高微信小程序的应用速度的手段有哪些" class="header-anchor">#</a> 提高微信小程序的应用速度的手段有哪些？</h2> <h3 id="一、加载优化"><a href="#一、加载优化" class="header-anchor">#</a> 一、加载优化</h3> <ol><li>控制代码包体积,及时清理无用代码</li> <li>使用子包按需加载,减少主包体积</li> <li>预加载子包,避免首次点击卡顿</li></ol> <h3 id="渲染优化"><a href="#渲染优化" class="header-anchor">#</a> 渲染优化</h3> <ol><li>onLoad 阶段发请求,不等待 onReady</li> <li>缓存本地数据,减少不必要的网络请求</li> <li>合并 setData 调用,避免频繁刷新界面</li> <li>抽离自定义组件,减少主界面渲染压力</li></ol> <h3 id="三、首屏优化"><a href="#三、首屏优化" class="header-anchor">#</a> 三、首屏优化</h3> <ol><li>预请求数据,利用缓存数据构建首屏</li> <li>采用骨架屏 placeholders 占位</li> <li>提前预加载资源包</li></ol> <h3 id="四、启动优化"><a href="#四、启动优化" class="header-anchor">#</a> 四、启动优化</h3> <ol><li>显示加载图标避免白屏</li> <li>合理制定启动图片大小</li></ol> <h3 id="五、长列表优化"><a href="#五、长列表优化" class="header-anchor">#</a> 五、长列表优化</h3> <ol><li>虚拟列表,减少 DOM 节点</li> <li>预加载可视区域外图片</li> <li>图片懒加载,滚动到可视区再加载</li></ol> <h3 id="六、打包策略"><a href="#六、打包策略" class="header-anchor">#</a> 六、打包策略</h3> <ol><li>压缩代码,上传时启用代码压缩</li> <li>按功能拆分子包</li> <li>删除无用文件,精简资源体积</li></ol> <h2 id="说说微信小程序的支付流程"><a href="#说说微信小程序的支付流程" class="header-anchor">#</a> 说说微信小程序的支付流程？</h2> <ol><li>用户通过分享或扫描二维码进入商户小程序，用户选择购买，完成选购流程。</li> <li>调起微信支付控件，用户开始输入支付密码。</li> <li>密码验证通过，支付成功。商户后台得到支付成功的通知。</li> <li>返回商户小程序，显示购买成功。</li> <li>微信支付公众号下发支付凭证。</li></ol> <h3 id="详细流程"><a href="#详细流程" class="header-anchor">#</a> 详细流程</h3> <p><img src="/assets/img/257037195-bf6913e6-253d-434b-b165-7e0648dc9c02.275211bc.png" alt=""></p> <ol><li>打开小程序，点击直接下单。此时，小程序会调用 wx.login 获取用户临时登录凭证 code，然后发送到后端服务器换取 openId。</li> <li>用户下单，小程序需要将购买的商品 Id，商品数量，以及用户的 openId 传送到服务器。</li> <li>服务器在接收到商品 Id、商品数量、openId 后，生成订单数据。同时，通过签名算法，向微信支付发送请求，获取预付单信息（prepay_id）。然后，服务器会将获取的数据再次进行签名，向小程序端响应必要的信息。</li> <li>小程序端在获取对应的参数后，调用 wx.requestPayment()发起微信支付，唤醒支付工作台，进行支付。
接下来，用户会进行微信支付密码、指纹等验证。确认支付之后，微信后台进行鉴权，直接返回给前端支付的结果。前端收到返回数据后对支付结果进行展示。</li> <li>最后，微信后台在给前端返回支付的结果后，也会向后台返回一个支付结果。后台通过这个支付结果来更新订单的状态。
以下是后端响应数据和 wx.requestPayment 方法所需要的参数示例：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>wx<span class="token punctuation">.</span><span class="token function">requestPayment</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 时间戳</span>
  <span class="token literal-property property">timeStamp</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 随机字符串</span>
  <span class="token literal-property property">nonceStr</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 统一下单接口返回的 prepay_id 参数值</span>
  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 签名类型</span>
  <span class="token literal-property property">signType</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 签名</span>
  <span class="token literal-property property">paySign</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// 调用成功回调</span>
  <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 失败回调</span>
  <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 接口调用结束回调</span>
  <span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="谈谈微信小程序的实现原理"><a href="#谈谈微信小程序的实现原理" class="header-anchor">#</a> 谈谈微信小程序的实现原理？</h2> <h3 id="一、背景"><a href="#一、背景" class="header-anchor">#</a> 一、背景</h3> <p>在传统的网页开发中，渲染线程和脚本是互斥的，这也是为什么长时间的脚本运行可能会导致页面失去响应的原因，因为我们常说的 JS 是单线程的。而微信小程序则选用了 Hybrid 的渲染方式，将视图层和逻辑层分开，实现双线程同时运行。在此模式下，视图层的界面使用 WebView 进行渲染，而逻辑层则在 JSCore 中运行。</p> <p><img src="/assets/img/257037430-f93a81e5-efa4-4c51-97e2-8a385b67a350.1d9e3af0.png" alt=""></p> <p>在小程序中，渲染层主要负责界面渲染相关的任务，并在 WebView 线程里执行。一个小程序可能存在多个界面，所以渲染层存在多个 WebView 线程。而逻辑层则采用 JsCore 线程运行 JS 脚本，执行的都是与小程序业务逻辑有关的代码。</p> <h3 id="二、通信"><a href="#二、通信" class="header-anchor">#</a> 二、通信</h3> <p>在小程序的渲染层，宿主环境会将 wxml 转化成对应的 JS 对象。当逻辑层的数据发生变更时，通过宿主环境提供的 setData 方法，数据就可以从逻辑层传递到渲染层。然后通过对比数据变化前后的差异，将差异应用在原来的 Dom 树上，从而渲染出正确的视图。</p> <p><img src="/assets/img/257037580-11df2ae8-f47d-41a7-8783-ac974629e1b3.39e938cb.png" alt=""></p> <p>例如，用户点击界面上某个按钮，这类反馈需要通知给开发者的逻辑层，以便将对应的处理状态呈现给用户。对于事件的分发处理，微信进行了特殊的处理，将所有的事件拦截后，丢到逻辑层，交给 JavaScript 进行处理。</p> <p><img src="/assets/img/257037493-0bcd34c9-2bdf-4017-a0bb-dc92e7cf91fa.0cd8c285.png" alt=""></p> <p>由于小程序是基于双线程的，因此在视图层和逻辑层之间的任何数据传递都是线程间的通信，会有一定的延时。所以在小程序中，页面更新成了异步操作。异步会使得各部分的运行时序变得复杂一些，逻辑层与渲染层需要有一定的机制保证时序正确，在每个小程序页面的生命周期中，存在着若干次页面数据通信。</p> <p><img src="/assets/img/257037604-8196b3df-6b5e-4d98-adc0-4e75bb537224.613e3610.png" alt=""></p> <h3 id="三、运行机制"><a href="#三、运行机制" class="header-anchor">#</a> 三、运行机制</h3> <p>小程序启动运行主要有两种情况：</p> <ul><li>冷启动（重新开始）：用户首次打开或者小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动，即为冷启动</li> <li>热启动：用户已经打开过小程序，然后在一定时间内再次打开该小程序，此时无需重新启动，只需要将后台态的小程序切换到前台，这个过程就是热启动
需要注意的是：</li></ul> <ol><li>小程序没有重启的概念</li> <li>当小程序进入后台，客户端会维持一段时间的运行状态，超过一定时间后会被微信主动销毁</li> <li>短时间内收到系统两次以上内存警告，也会对小程序进行销毁，这也就为什么一旦页面内存溢出，页面会奔溃的本质原因了</li></ol> <p><img src="/assets/img/257037475-12890608-2787-428e-a822-56b3e1d07dfe.8e67040d.png" alt="">
当开发者在后台发布新版本之后，无法立刻影响到所有现网用户，但最差情况下，也在发布之后 24 小时之内下发新版本信息到用户。每次冷启动时，都会检查是否有更新版本，如果发现有新版本，将会异步下载新版本的代码包，并同时用客户端本地的包进行启动，即新版本的小程序需要等下一次冷启动才会应用上。</p> <h3 id="四、举例说明"><a href="#四、举例说明" class="header-anchor">#</a> 四、举例说明</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Hello, World!'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">changeText</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">'Hello, OpenAI!'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 页面加载时，打印初始数据</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">onReady</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 页面初次渲染完成后，改变数据</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">changeText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function-variable function">onShow</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 页面显示后，打印改变后的数据</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在这个示例中，我们首先在 Page 对象的 data 属性中定义了初始数据 text。当页面加载完成后，我们在 onLoad 生命周期函数中打印出初始数据。然后在页面初次渲染完成后，我们通过 this.setData 方法改变数据。最后在页面显示后，我们打印出改变后的数据。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/22/2023, 5:12:45 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/interview/article-10.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        算法面试题
      </a></span> <span class="next"><a href="/interview/article-12.html">
        3D图形学面试题
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.db4255f7.js" defer></script><script src="/assets/js/3.a5cb75aa.js" defer></script><script src="/assets/js/11.4457209d.js" defer></script>
  </body>
</html>