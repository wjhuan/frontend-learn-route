<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>JS底层堆栈内存处理机制 | 前端食堂</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="/assets/logo.png">
    <meta name="description" content="A lightweight creator for VuePress project.">
    <link rel="preload" href="/assets/css/0.styles.a0bdfdfc.css" as="style"><link rel="preload" href="/assets/js/app.78d16a5a.js" as="script"><link rel="preload" href="/assets/js/3.6aae29e9.js" as="script"><link rel="preload" href="/assets/js/12.308064cc.js" as="script"><link rel="prefetch" href="/assets/js/10.e8e4d9d0.js"><link rel="prefetch" href="/assets/js/11.f51b88d6.js"><link rel="prefetch" href="/assets/js/13.4edebad8.js"><link rel="prefetch" href="/assets/js/14.005b70eb.js"><link rel="prefetch" href="/assets/js/15.0ea3516d.js"><link rel="prefetch" href="/assets/js/16.773deb60.js"><link rel="prefetch" href="/assets/js/17.2d19a447.js"><link rel="prefetch" href="/assets/js/18.70e94326.js"><link rel="prefetch" href="/assets/js/19.c53e1e98.js"><link rel="prefetch" href="/assets/js/20.8f0b69c3.js"><link rel="prefetch" href="/assets/js/21.61386968.js"><link rel="prefetch" href="/assets/js/22.f7ea89c7.js"><link rel="prefetch" href="/assets/js/23.f187e0c0.js"><link rel="prefetch" href="/assets/js/24.35a2ca51.js"><link rel="prefetch" href="/assets/js/25.f8d8f872.js"><link rel="prefetch" href="/assets/js/26.b458fac9.js"><link rel="prefetch" href="/assets/js/27.46167149.js"><link rel="prefetch" href="/assets/js/28.ee2efdfc.js"><link rel="prefetch" href="/assets/js/29.957b5902.js"><link rel="prefetch" href="/assets/js/30.ad38e51e.js"><link rel="prefetch" href="/assets/js/31.76ba0b79.js"><link rel="prefetch" href="/assets/js/32.5322ea36.js"><link rel="prefetch" href="/assets/js/33.603eda6c.js"><link rel="prefetch" href="/assets/js/34.04048073.js"><link rel="prefetch" href="/assets/js/35.db42af6e.js"><link rel="prefetch" href="/assets/js/36.a3819c4c.js"><link rel="prefetch" href="/assets/js/37.8a5ed3bd.js"><link rel="prefetch" href="/assets/js/38.60d2319a.js"><link rel="prefetch" href="/assets/js/39.3fa6a500.js"><link rel="prefetch" href="/assets/js/4.8d1a23b6.js"><link rel="prefetch" href="/assets/js/40.4241fae9.js"><link rel="prefetch" href="/assets/js/41.883803af.js"><link rel="prefetch" href="/assets/js/42.907eb3d9.js"><link rel="prefetch" href="/assets/js/43.739e3ede.js"><link rel="prefetch" href="/assets/js/44.d99fecbd.js"><link rel="prefetch" href="/assets/js/45.d38bc9ce.js"><link rel="prefetch" href="/assets/js/46.9ae96c69.js"><link rel="prefetch" href="/assets/js/47.ebda2922.js"><link rel="prefetch" href="/assets/js/48.03372027.js"><link rel="prefetch" href="/assets/js/49.ae8d2601.js"><link rel="prefetch" href="/assets/js/5.00133c68.js"><link rel="prefetch" href="/assets/js/50.b396cf06.js"><link rel="prefetch" href="/assets/js/51.d4ed198c.js"><link rel="prefetch" href="/assets/js/52.e097122a.js"><link rel="prefetch" href="/assets/js/53.dab025bd.js"><link rel="prefetch" href="/assets/js/54.2f236fbf.js"><link rel="prefetch" href="/assets/js/55.ff17689c.js"><link rel="prefetch" href="/assets/js/56.9f537141.js"><link rel="prefetch" href="/assets/js/57.3e963a0f.js"><link rel="prefetch" href="/assets/js/58.abfee5f1.js"><link rel="prefetch" href="/assets/js/59.efef8fcf.js"><link rel="prefetch" href="/assets/js/6.e42c6557.js"><link rel="prefetch" href="/assets/js/60.7b5c1609.js"><link rel="prefetch" href="/assets/js/61.9d39e7b9.js"><link rel="prefetch" href="/assets/js/62.a674f1af.js"><link rel="prefetch" href="/assets/js/63.ab8188bf.js"><link rel="prefetch" href="/assets/js/64.9d0dff14.js"><link rel="prefetch" href="/assets/js/65.784a00c0.js"><link rel="prefetch" href="/assets/js/66.66b63f3c.js"><link rel="prefetch" href="/assets/js/67.f20ed9ae.js"><link rel="prefetch" href="/assets/js/68.12dc466e.js"><link rel="prefetch" href="/assets/js/69.f4c3fc57.js"><link rel="prefetch" href="/assets/js/7.7966727e.js"><link rel="prefetch" href="/assets/js/70.4fa47591.js"><link rel="prefetch" href="/assets/js/71.4875c748.js"><link rel="prefetch" href="/assets/js/72.8e2ea4c5.js"><link rel="prefetch" href="/assets/js/73.50e2a9f2.js"><link rel="prefetch" href="/assets/js/8.e71f1508.js"><link rel="prefetch" href="/assets/js/9.4fe40565.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.4b66c0f2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a0bdfdfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="sidebar-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active no-logo home-link"><!----> <span class="site-name">前端食堂</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><a class="ant-dropdown-link ant-dropdown-trigger">
      Hover me <i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></a> <a href="https://github.com/wjhuan/frontend-learn-route" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/javascript/" aria-current="page" title="README.md" class="sidebar-link">README.md</a></li><li><a href="/javascript/article-1.html" title="数据类型" class="sidebar-link">数据类型</a></li><li><a href="/javascript/article-2.html" aria-current="page" title="JS底层堆栈内存处理机制" class="active sidebar-link">JS底层堆栈内存处理机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/javascript/article-2.html#代码运行环境" title="代码运行环境" class="sidebar-link">代码运行环境</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#堆-heap-栈-stack-内存" title="堆(Heap)栈(Stack)内存" class="sidebar-link">堆(Heap)栈(Stack)内存</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#执行上下文" title="执行上下文" class="sidebar-link">执行上下文</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#全局对象" title="全局对象" class="sidebar-link">全局对象</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#定义变量赋值操作步骤" title="定义变量赋值操作步骤" class="sidebar-link">定义变量赋值操作步骤</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#变量提升机制" title="变量提升机制" class="sidebar-link">变量提升机制</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#块级私有上下文" title="块级私有上下文" class="sidebar-link">块级私有上下文</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#let-const-var-的区别" title="let\const\var 的区别" class="sidebar-link">let\const\var 的区别</a></li><li class="sidebar-sub-header"><a href="/javascript/article-2.html#js-事件循环机制" title="js 事件循环机制" class="sidebar-link">js 事件循环机制</a></li></ul></li><li><a href="/javascript/article-3.html" title="闭包作用域和浏览器垃圾回收机制" class="sidebar-link">闭包作用域和浏览器垃圾回收机制</a></li><li><a href="/javascript/article-4.html" title="this的几种基本情况" class="sidebar-link">this的几种基本情况</a></li><li><a href="/javascript/article-5.html" title="面向对象" class="sidebar-link">面向对象</a></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="js-底层堆栈内存处理机制"><a href="#js-底层堆栈内存处理机制" class="header-anchor">#</a> JS 底层堆栈内存处理机制</h1> <h2 id="代码运行环境"><a href="#代码运行环境" class="header-anchor">#</a> 代码运行环境</h2> <ol><li><p>浏览器<code>「内核：webkit(blink)、gecko、presto、trident、Chromium...」</code></p></li> <li><p>IOS/安卓原型 App 中，基于 <code>webview</code> 运行页面和 <code>JS「内核：webkit」</code></p> <blockquote><p>支持 <code>window</code>、没有 <code>global</code>、支持 <code>ES6Module</code> 模块规范、不支持 <code>CommonJS</code> 模块规范</p></blockquote></li> <li><p>Node<code>「内核：webkit」</code></p> <blockquote><p>特点：支持 <code>global</code>、不支持 <code>window</code>、支持 <code>CommonJS</code>、不支持 <code>ES6Module</code></p></blockquote></li> <li><p>webpack<code>「基于 Node 环境编译打包 JS，最后把编译后的结果运行在浏览器中」</code></p> <blockquote><p>特点：浏览器和 <code>Node</code> 环境支持的他都支持</p></blockquote></li></ol> <blockquote><p>不论什么环境下执行代码，总要开辟出相关的内存(执行内存/内存条)，用来存储值<code>「Heap 堆内存」</code>以及运行代码<code>「Satck 栈内存 -&gt; E（Execution）C（Context）Stack 执行环境栈」</code></p></blockquote> <h2 id="堆-heap-栈-stack-内存"><a href="#堆-heap-栈-stack-内存" class="header-anchor">#</a> 堆(Heap)栈(Stack)内存</h2> <blockquote><p>都是在计算机内存中开辟的空间</p></blockquote> <ol><li>栈内存 <code>Stack：ECStack（Execution [ˌeksɪˈkjuːʃn] Context Stack）</code> <ul><li>存储原始值类型值</li> <li>代码执行的环境</li></ul></li> <li>堆内存 <code>Heap</code> <ul><li>存储对象类型值</li></ul></li></ol> <h2 id="执行上下文"><a href="#执行上下文" class="header-anchor">#</a> 执行上下文</h2> <p><code>EC（Execution [ˌeksɪˈkjuːʃn] Context ）</code>执行上下文：区分代码执行的环境</p> <ol><li>常见上下文分类
<ul><li>全局上下文 EC(G)</li> <li>函数私有上下文 EC(FN)</li> <li>块级私有上下文 EC(BLOCK)</li></ul></li> <li>产生私有上下文 -&gt; 进栈执行 -&gt; 出栈释放(可能释放)</li> <li>变量对象：当前上下文中，用来存储声明的变量的地方
<ul><li><code>VO（Varibale Object）</code>：<code>VO(G)</code> 或者 <code>VO(BLOCK)</code></li> <li><code>AO（Active Object）</code>：<code>AO(?)</code></li></ul></li></ol> <h2 id="全局对象"><a href="#全局对象" class="header-anchor">#</a> 全局对象</h2> <p><code>GO（Global Object）</code>全局对象</p> <ol><li><code>window</code> 指向 <code>GO</code> 对象</li> <li>全局上下文中，基于<code>var/function</code>声明的变量是直接存储到<code>GO</code>对象上的；而基于<code>let/const</code>声明的变量才是存放在<code>VO(G)</code>中的；</li></ol> <h2 id="定义变量赋值操作步骤"><a href="#定义变量赋值操作步骤" class="header-anchor">#</a> 定义变量赋值操作步骤</h2> <ol><li>第一步：创建值
<ul><li>原始值类型：直接存储在栈内存中，按值操作</li> <li>对象类型值：按照堆内存地址来操作
<ul><li>对象：开辟一个堆内存空间(16 进制地址)、依次存储对象的键值对、把空间地址赋值给变量</li> <li>函数：内存空间中存储三部分信息
<ul><li>作用域 [[scope]]：当前所处上下文</li> <li>函数体中的代码字符串</li> <li>当做普通对象存储的静态属性和方法「name &amp; length」</li></ul></li></ul></li> <li>第二步：声明变量 declare</li> <li>第三步：变量和值关联在一起（赋值） defined</li></ul></li></ol> <p><img src="/assets/img/ECstack-Heap.be839ec7.jpg" alt=""></p> <h3 id="练习题"><a href="#练习题" class="header-anchor">#</a> 练习题</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> a
a<span class="token punctuation">.</span>x <span class="token operator">=</span> a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
</code></pre></div><p><img src="/assets/img/ec-02.f9bb738b.jpg" alt=""></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">100</span>
  y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span>
  y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">200</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">fn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
</code></pre></div><p><img src="/assets/img/ec-fn.1231c34e.jpg" alt=""></p> <h2 id="变量提升机制"><a href="#变量提升机制" class="header-anchor">#</a> 变量提升机制</h2> <p>在“当前上下文”中，代码执行之前，浏览器首先会把所有带<code>var/function</code>关键字的进行提前声明或者定义：带<code>var</code>的只是提前声明 &amp; 带<code>function</code>的，此阶段声明+定义{赋值}都完成了</p> <ol><li><code>let/const/import/class</code> 声明的变量不存在变量提升</li> <li>重复声明的问题</li> <li>推荐使用函数表达式，确保函数执行只能放在“创建函数”的下面，保证逻辑严谨性</li> <li>条件判断：在当前上下文中，变量提升阶段，不论条件是否成立，都要进行变量提升
<ul><li>var：还是只声明</li> <li>function：判断体中的函数，在变量提升阶段，只声明不赋值「函数是个渣男」</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
 EC(G)全局执行上下文
   VO(G)/GO
     a -&gt; 12
   变量提升：var a;
   代码执行
*/</span>
<span class="token number">1.</span> 其实最开始浏览器从服务器端获取的<span class="token constant">JS</span><span class="token function">都是文本</span><span class="token punctuation">(</span>字符串<span class="token punctuation">)</span>，只不过声明了其格式是「Content<span class="token operator">-</span>Type<span class="token operator">:</span> application<span class="token operator">/</span>javascript<span class="token punctuation">;</span>」，浏览器首先按照这个格式去解析代码 <span class="token operator">-</span><span class="token operator">&gt;</span> “词法解析”阶段「目标是生成“<span class="token constant">AST</span>词法解析树”」
<span class="token number">2.</span> 基于<span class="token keyword">let</span><span class="token operator">/</span><span class="token keyword">const</span>等声明的变量：在词法解析阶段，其实就已经明确了，未来在此上下文中，必然会存在这些变量；代码执行中，如果出现在具体声明的代码之前使用这些变量，浏览器会抛出错误！！

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">12</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">//Uncaught ReferenceError: Cannot access 'b' before initialization</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">12</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
 EC(G)
   VO(G)/GO
     fn -&gt; 0x001 [[scope]]:EC(G)
        -&gt; 0x002 [[scope]]:EC(G)
        -&gt; 12
   变量提升:
     function fn(){ console.log(1); }
     var fn;  //上下文中已经存在fn变量了，不会重复声明
     function fn(){ console.log(2); }
   代码执行:
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment">//function-&gt;2</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token comment">//跳过「变量提升阶段已经处理过了」</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment">//function-&gt;2</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token number">12</span> <span class="token comment">//跳过var fn操作，但是赋值的操作在变量提升阶段没搞过，需要执行</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment">//12</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token comment">//跳过</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token comment">//12</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/*
 EC(G)
   VO(G)/GO
     a
   变量提升：不论条件是否成立，都要进行变量提升（对于var来讲新老版本浏览器没有任何影响，但是对于判断体中出现的function来讲，新老版本表现不一致：老版本 函数还是声明+定义  新版本 函数只会声明，不在定义）
     var a;
 */</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//undefined</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//'a' in window  TRUE</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">13</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//undefined</span>
</code></pre></div><h2 id="块级私有上下文"><a href="#块级私有上下文" class="header-anchor">#</a> 块级私有上下文</h2> <p>除<code>函数和对象</code>的大括号外<code>「例如：判断体/循环体/代码块…」</code>，如果在大括号中出现了 <code>let/const/function/class</code> 等关键词声明变量，则当前大括号会产生一个<code>块级私有上下文</code>；它的上级上下文是所处的环境；<code>var</code> 不产生，也不受块级上下文的影响；</p> <ol><li>函数是个渣男</li> <li>循环中的块级上下文</li></ol> <p><img src="/assets/img/block-context.17ad3daa.jpg" alt=""></p> <h2 id="let-const-var-的区别"><a href="#let-const-var-的区别" class="header-anchor">#</a> let\const\var 的区别</h2> <ol><li><code>let</code>不存在变量提升,不允许在定义之前使用</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//undefined</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">12</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">//Uncaught ReferenceError: Cannot access 'b' before initialization</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">13</span>
</code></pre></div><ol start="2"><li><code>let</code>不允许重复声明「不论当前上下文中，基于何种方式声明过这个变量，都不允许基于<code>let</code>再次声明」
<blockquote><p><code>Uncaught SyntaxError: Identifier 'a' has already been declared</code>在词法解析阶段，发现有基于 <code>let</code>重复声明，词法解析就报错了，所以 <code>JS</code> 代码都不会执行</p></blockquote></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'OK'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">12</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">13</span>
</code></pre></div><ol start="3"><li><p>在全局上下文中，基于<code>var/function</code>声明的变量，是给<code>window(GO)</code>设置的全局属性；基于<code>let/const</code>声明的变量是放在<code>VO(G)</code>中的，和<code>GO</code>没有任何的关系；</p></li> <li><p><code>let</code>会产生块级上下文</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">12</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">13</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token comment">//12 13</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//12</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">//Uncaught ReferenceError: b is not defined  b是块级上下文中私有的</span>
</code></pre></div><ol start="5"><li><code>let</code>的暂时性死区问题</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// console.log(typeof a); //&quot;undefined&quot; 基于typeof检测一个未被声明的变量，结果不会抱错，而是&quot;undefined&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span> <span class="token comment">//Uncaught ReferenceError: Cannot access 'a' before initialization</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">100</span>
</code></pre></div><ol start="6"><li>基于<code>const</code> 声明的变量，首先必须赋值初始值，而且一但和某个值关联，后期不允许更改其指针指向（也就是不能重新赋值为其他的值)</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> a<span class="token punctuation">;</span> <span class="token comment">//Uncaught SyntaxError: Missing initializer in const declaration</span>
</code></pre></div><h2 id="js-事件循环机制"><a href="#js-事件循环机制" class="header-anchor">#</a> js 事件循环机制</h2> <h3 id="进程-vs-线程"><a href="#进程-vs-线程" class="header-anchor">#</a> 进程 vs 线程</h3> <ol><li>进程其实就是一个程序(浏览器中打开一个页面，也是开辟一个进程)</li> <li>线程是进程中具体去执行相关任务的</li></ol> <blockquote><p>同步编程：只能一件事一件事的处理，上一件事情完成，才能处理下一件事情「一般都是因为单线程」,异步编程：同时可以处理多件事情「一般是因为多线程」</p></blockquote> <ol start="3"><li><p>浏览器是多线程的，可以同时处理很多事情：</p> <ul><li>GUI 渲染线程</li> <li>JS 引擎线程「JS 引擎线程会把栈内存中的代码逐行解析执行」</li> <li>监听事件触发线程</li> <li>定时触发器线程</li> <li>异步 HTTP 请求线程</li> <li>WebWorker
<blockquote><p>所以浏览器利用多线程，完全可以同时处理很多事情，实现异步编程~~</p></blockquote></li></ul></li> <li><p>JS 代码的执行是单线程的：因为浏览器只分配一个线程“JS 引擎线程(主线程)”用来渲染和解析 JS</p></li> <li><p>JS 中大部分代码都是同步的：如果此时主线程正在执行某些代码，那么其余的事情都做不了（例如：循环就是同步代码，如果 JS 中出现死循环，那么主线程永远空闲不下来，其他的事情都处理不了，整个页面就卡在这卡死了！！！）</p></li> <li><p>JS 中也有一部分代码是异步的：并不是像想象中的同时执行很多代码，而是“基于 EventLoop&amp;浏览器的多线程机制”实现出监听、排队的机制</p></li> <li><p>异步微任务：优先级高</p> <ul><li>requestAnimationFrame 实现 JS 动画</li> <li>Promise.then | resolve/reject</li> <li>await</li> <li>queueMicrotask 创建一个新的异步微任务</li> <li>IntersectionObserver 监听 DOM 元素和视口交叉的信息</li> <li>MutationObserver 监听 DOM 元素属性改变</li> <li>process.nextTick</li></ul></li> <li><p>异步宏任务：优先级低</p> <ul><li>setTimeout/setInterval</li> <li>事件绑定</li> <li>ajax/fetch 异步数据请求</li> <li>MessageChannel</li> <li>setImmediate</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">90000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/assets/img/Xnip2021-12-15_21-12-55.f55376c1.jpg" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/12/2023, 10:39:09 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/javascript/article-1.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        数据类型
      </a></span> <span class="next"><a href="/javascript/article-3.html">
        闭包作用域和浏览器垃圾回收机制
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.78d16a5a.js" defer></script><script src="/assets/js/3.6aae29e9.js" defer></script><script src="/assets/js/12.308064cc.js" defer></script>
  </body>
</html>